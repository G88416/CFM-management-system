<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity And Faith Mission Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Added libraries for enhanced bulk import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.2/mammoth.browser.min.js"></script>
    <!-- Stripe for payment gateway -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD&intent=capture"></script>
    <!-- AI Integration: Simple client-side AI simulation using fuzzy search and template generation (enhanced with Levenshtein distance for identification) -->
    <script src="https://cdn.jsdelivr.net/npm/fuzzysort@2.0.0/fuzzysort.min.js"></script> <!-- For fuzzy matching in searches/uploads -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        nav {
            background-color: #34495e;
            padding: 10px;
            text-align: center;
        }
        nav button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        nav button:hover {
            background-color: #2980b9;
        }
        nav button.active {
            background-color: #e74c3c;
        }
        .content {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 20px auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }
        input, select, button, textarea, .file-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        select[multiple] {
            height: 150px;
        }
        input[readonly] {
            background-color: #f9f9f9;
        }
        .file-input {
            border: none;
            background-color: #f9f9f9;
        }
        button[type="submit"] {
            background-color: #27ae60;
            color: white;
            border: none;
            cursor: pointer;
        }
        button[type="submit"]:hover {
            background-color: #229954;
        }
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            display: inline-block;
            margin: 5px 0;
        }
        .whatsapp-btn:hover {
            background-color: #128C7E;
        }
        a.whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        a.whatsapp-link:hover {
            text-decoration: underline;
        }
        .event-list, .tithe-list, .assignment-list, .employee-list, .leave-list, .leader-list, .pastor-list, .cell-list, .elder-list, .report-list, .whatsapp-list, .follow-up-list, .reminder-list, .attendance-list {
            list-style: none;
            padding: 0;
        }
        .event-item, .tithe-item, .assignment-item, .employee-item, .leave-item, .leader-item, .pastor-item, .cell-item, .elder-item, .report-item, .whatsapp-item, .follow-up-item, .reminder-item, .attendance-item {
            background-color: #f9f9f9;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .reminder-item.due {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .reminder-item.overdue {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .total {
            font-weight: bold;
            background-color: #e8f5e8;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 1em;
        }
        .bulk-upload {
            margin-bottom: 20px;
        }
        .bulk-upload input[type="file"] {
            max-width: 300px;
        }
        /* Added preview styles */
        #filePreview {
            margin: 10px 0;
            border: 1px solid #ddd;
            padding: 10px;
            max-height: 300px;
            overflow: auto;
            display: none;
        }
        #filePreview table {
            width: 100%;
            border-collapse: collapse;
        }
        #filePreview canvas {
            max-width: 100%;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .search-container input {
            width: 100%;
            max-width: 300px;
        }
        .leaders-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .leaders-section {
            flex: 1;
            min-width: 300px;
        }
        .events-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .events-section {
            flex: 1;
            min-width: 300px;
        }
        details {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        summary {
            padding: 10px;
            background-color: #f2f2f2;
            cursor: pointer;
            font-weight: bold;
        }
        .folder-content {
            padding: 10px;
        }
        .folder-actions {
            margin-top: 10px;
            text-align: right;
        }
        .folder-actions button {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .folder-actions .print-btn {
            background-color: #f39c12;
            color: white;
        }
        .folder-actions .export-btn {
            background-color: #3498db;
            color: white;
        }
        .folder-actions .email-btn {
            background-color: #27ae60;
            color: white;
        }
        .folder-actions .minimize-btn {
            background-color: #e74c3c;
            color: white;
        }
        .transport-table input, .essentials-table input, .sunday-school-table input, .grocery-table input, .sound-media-table input, .stage-deco-table input, .guest-pastor-table input {
            width: 100px;
        }
        .budget-date {
            margin-bottom: 10px;
        }
        .budget-total {
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            background-color: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 5px;
            text-align: center;
            font-size: 1em;
            color: #27ae60;
        }
        .grand-total {
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            background-color: #d4edda;
            border: 2px solid #28a745;
            border-radius: 5px;
            text-align: center;
            font-size: 1.1em;
            color: #155724;
        }
        .generate-report-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .generate-report-btn:hover {
            background-color: #2980b9;
        }
        .report-download-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 5px;
        }
        .report-delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .history-icon {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            margin: 10px;
            display: inline-block;
        }
        .history-section {
            display: none;
            margin-top: 20px;
        }
        .history-section.active {
            display: block;
        }
        .history-report-item {
            background-color: #f9f9f9;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        button.delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
        }
        button.convert-btn {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .add-item-form {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .add-item-form input {
            flex: 1;
            min-width: 150px;
        }
        .add-item-form button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .template-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .template-btn {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .template-btn:hover {
            background-color: #128C7E;
        }
        .ai-suggest-btn {
            background-color: #9b59b6;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .ai-suggest-btn:hover {
            background-color: #8e44ad;
        }
        .whatsapp-history {
            margin-top: 20px;
        }
        .whatsapp-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .whatsapp-item-details {
            flex: 1;
        }
        .broadcast-form {
            max-width: 600px;
        }
        .broadcast-select {
            height: 200px;
        }
        .broadcast-actions {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .broadcast-btn {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .broadcast-btn:hover {
            background-color: #d35400;
        }
        .converted {
            background-color: #d4edda;
            font-style: italic;
        }
        .analytics-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .chart-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background-color: #e8f5e8;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            font-size: 1.2em;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #27ae60;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #c3e6cb;
            z-index: 1000;
            display: none;
        }
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .bulk-send-btn {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        .bulk-send-btn:hover {
            background-color: #128C7E;
        }
        .tithe-message-form, .contributor-message-form {
            max-width: 500px;
        }
        .conference-select {
            margin-bottom: 10px;
        }
        .attendance-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }
        .attendance-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        /* Payment Gateway Styles */
        #paymentModal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .payment-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }
        #card-element {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        #card-errors {
            color: red;
            margin-top: 10px;
        }
        .recurring-option {
            margin: 10px 0;
        }
        .payment-method {
            display: none;
        }
        .payment-method.active {
            display: block;
        }
        #paypal-button-container {
            margin: 10px 0;
        }
        .conference-file-upload {
            margin-bottom: 20px;
        }
        .conference-file-upload input[type="file"] {
            max-width: 300px;
        }
        .file-download-link {
            color: #3498db;
            text-decoration: none;
            margin-right: 10px;
        }
        .file-download-link:hover {
            text-decoration: underline;
        }
        .view-btn {
            background-color: #9b59b6;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
            margin-right: 5px;
        }
        /* Enhanced File Viewer Modal */
        #fileViewerModal {
            display: none;
            position: fixed;
            z-index: 2001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            overflow: auto;
        }
        .file-viewer-content {
            background-color: white;
            margin: 2% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: auto;
            position: relative;
        }
        .file-viewer-content iframe,
        .file-viewer-content canvas,
        .file-viewer-content table {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            max-width: 100%;
        }
        .file-viewer-content .close-viewer {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .file-viewer-content .close-viewer:hover {
            color: black;
        }
        .viewer-loading {
            text-align: center;
            padding: 50px;
        }
        .viewer-toolbar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .viewer-toolbar button {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
        }
        .viewer-toolbar button:hover {
            background-color: #2980b9;
        }
        .viewer-toolbar input[type="number"] {
            width: 60px;
            padding: 5px;
        }
        .pdf-page-nav {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        .pdf-canvas {
            margin: 10px 0;
            border: 1px solid #ddd;
            display: block;
            margin: 0 auto;
        }
        .zoom-controls {
            display: flex;
            gap: 5px;
        }
        .docx-content, .xlsx-content {
            overflow-x: auto;
        }
        /* Validation Styles */
        input:invalid, select:invalid, textarea:invalid {
            border-color: #dc3545;
        }
        input:valid, select:valid, textarea:valid {
            border-color: #28a745;
        }
        .error-message {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 0.25rem;
            display: none;
        }
        .error-message.show {
            display: block;
        }
        /* AI Suggestion Overlay */
        #ai-suggestion {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 3000;
            display: none;
            max-width: 400px;
        }
        #ai-suggestion button {
            margin: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Charity And Faith Mission Management System</h1>
        <p>Welcome to your church dashboard</p>
    </header>
    
    <nav>
        <button onclick="showSection('members', this)" class="active">Members</button>
        <button onclick="showSection('visitors', this)">Visitors</button>
        <button onclick="showSection('analytics', this)">Analytics</button>
        <button onclick="showSection('events', this)">Events</button>
        <button onclick="showSection('tithe', this)">Tithe & Offering</button>
        <button onclick="showSection('church-admin', this)">Church Admin</button>
        <button onclick="showSection('attendance', this)">Church Attendance</button>
        <button onclick="showSection('whatsapp', this)">WhatsApp Interactions</button>
        <button onclick="showSection('vault', this)">Vault</button>
    </nav>
    
    <div id="members" class="content active">
        <h2>Member Directory</h2>
        <div class="bulk-upload">
            <h3>Bulk Upload Members</h3>
            <p>Supported: CSV, XLSX, PDF, DOCX. Format: name,email,cell,address,joinDate,role,branch</p>
            <div id="membersFilePreview" class="file-preview"></div>
            <form id="bulkMemberForm">
                <input type="file" id="bulkCsv" accept=".csv,.xlsx,.pdf,.docx" required>
                <button type="submit">Upload File</button>
            </form>
        </div>
        <div class="search-container">
            <h3>Search Members</h3>
            <input type="text" id="memberSearch" placeholder="Search by name, email, cell, address, or role..." >
        </div>
        <details id="mdf-folder">
            <summary>MDF</summary>
            <div class="folder-content">
                <form id="memberForm" novalidate>
                    <label for="name">Full Name:</label>
                    <input type="text" id="name" placeholder="Full Name" required minlength="2" maxlength="100">
                    <div class="error-message" id="name-error"></div>
                    <label for="branch">Branch:</label>
                    <select id="branch" required>
                        <option value="">Select Branch</option>
                        <option value="Khutsong">Khutsong</option>
                        <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                        <option value="Mahube">Mahube</option>
                        <option value="Phase 5">Phase 5</option>
                        <option value="Kwamhlanga">Kwamhlanga</option>
                        <option value="Kameel Port">Kameel Port</option>
                        <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                        <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                    </select>
                    <div class="error-message" id="branch-error"></div>
                    <label for="email">Email:</label>
                    <input type="email" id="email" placeholder="Email" required>
                    <div class="error-message" id="email-error"></div>
                    <label for="cell">Cell Number:</label>
                    <input type="tel" id="cell" placeholder="Cell Number (e.g., +1234567890)" required pattern="[+]?[0-9\s\-\(\)]{10,}" title="Enter a valid phone number (at least 10 digits)">
                    <div class="error-message" id="cell-error"></div>
                    <label for="address">Address:</label>
                    <input type="text" id="address" placeholder="Address" required minlength="5" maxlength="200">
                    <div class="error-message" id="address-error"></div>
                    <label for="joinDate">Join Date:</label>
                    <input type="date" id="joinDate" required max="2025-11-03">
                    <div class="error-message" id="joinDate-error"></div>
                    <label for="role">Role:</label>
                    <select id="role" required>
                        <option value="">Select Role</option>
                        <option value="Member">Member</option>
                        <option value="Volunteer">Volunteer</option>
                        <option value="Leader">Leader</option>
                    </select>
                    <div class="error-message" id="role-error"></div>
                    <button type="submit">Add Member</button>
                </form>
                <table id="memberTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Branch</th>
                            <th>Email</th>
                            <th>Cell Number</th>
                            <th>Address</th>
                            <th>Join Date</th>
                            <th>Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Members will be added here -->
                    </tbody>
                </table>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('mdf')">Print</button>
                    <button class="export-btn" onclick="exportMembers()">Export</button>
                    <button class="email-btn" onclick="emailMembers()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('mdf')">Minimize</button>
                </div>
            </div>
        </details>
    </div>

    <div id="visitors" class="content">
        <h2>Visitor Directory</h2>
        <div class="bulk-upload">
            <h3>Bulk Upload Visitors</h3>
            <p>Supported: CSV, XLSX, PDF, DOCX. Format: name,email,cell,address,visitDate,branch,notes</p>
            <div id="visitorsFilePreview" class="file-preview"></div>
            <form id="bulkVisitorForm">
                <input type="file" id="bulkVisitorCsv" accept=".csv,.xlsx,.pdf,.docx" required>
                <button type="submit">Upload File</button>
            </form>
        </div>
        <div class="search-container">
            <h3>Search Visitors</h3>
            <input type="text" id="visitorSearch" placeholder="Search by name, email, cell, address, or branch..." >
        </div>
        <details id="visitor-directory-folder">
            <summary>Visitor Directory</summary>
            <div class="folder-content">
                <form id="visitorForm" novalidate>
                    <label for="visitorName">Full Name:</label>
                    <input type="text" id="visitorName" placeholder="Full Name" required minlength="2" maxlength="100">
                    <div class="error-message" id="visitorName-error"></div>
                    <label for="visitorBranch">Branch:</label>
                    <select id="visitorBranch">
                        <option value="">Select Branch</option>
                        <option value="Khutsong">Khutsong</option>
                        <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                        <option value="Mahube">Mahube</option>
                        <option value="Phase 5">Phase 5</option>
                        <option value="Kwamhlanga">Kwamhlanga</option>
                        <option value="Kameel Port">Kameel Port</option>
                        <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                        <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                    </select>
                    <div class="error-message" id="visitorBranch-error"></div>
                    <label for="visitorEmail">Email:</label>
                    <input type="email" id="visitorEmail" placeholder="Email">
                    <div class="error-message" id="visitorEmail-error"></div>
                    <label for="visitorCell">Cell Number:</label>
                    <input type="tel" id="visitorCell" placeholder="Cell Number (e.g., +1234567890)" required pattern="[+]?[0-9\s\-\(\)]{10,}" title="Enter a valid phone number (at least 10 digits)">
                    <div class="error-message" id="visitorCell-error"></div>
                    <label for="visitorAddress">Address:</label>
                    <input type="text" id="visitorAddress" placeholder="Address" minlength="5" maxlength="200">
                    <div class="error-message" id="visitorAddress-error"></div>
                    <label for="visitorVisitDate">Visit Date:</label>
                    <input type="date" id="visitorVisitDate" required max="2025-11-03">
                    <div class="error-message" id="visitorVisitDate-error"></div>
                    <label for="visitorNotes">Notes:</label>
                    <textarea id="visitorNotes" placeholder="Notes (e.g., interests, follow-up needs)" maxlength="500"></textarea>
                    <div class="error-message" id="visitorNotes-error"></div>
                    <button type="submit">Add Visitor</button>
                </form>
                <table id="visitorTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Branch</th>
                            <th>Email</th>
                            <th>Cell Number</th>
                            <th>Address</th>
                            <th>Visit Date</th>
                            <th>Notes</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Visitors will be added here -->
                    </tbody>
                </table>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('visitor-directory')">Print</button>
                    <button class="export-btn" onclick="exportVisitors()">Export</button>
                    <button class="email-btn" onclick="emailVisitors()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('visitor-directory')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="follow-ups-folder">
            <summary>Visitor Follow-ups</summary>
            <div class="folder-content">
                <form id="followUpForm" novalidate>
                    <label for="followUpVisitorSelect">Visitor:</label>
                    <select id="followUpVisitorSelect" required>
                        <option value="">Select Visitor</option>
                    </select>
                    <div class="error-message" id="followUpVisitorSelect-error"></div>
                    <label for="followUpStatus">Status:</label>
                    <select id="followUpStatus" required>
                        <option value="">Select Status</option>
                        <option value="Contacted">Contacted</option>
                        <option value="Interested">Interested</option>
                        <option value="Joined">Joined</option>
                        <option value="Not Interested">Not Interested</option>
                    </select>
                    <div class="error-message" id="followUpStatus-error"></div>
                    <label for="followUpDate">Date:</label>
                    <input type="date" id="followUpDate" max="2025-11-03">
                    <div class="error-message" id="followUpDate-error"></div>
                    <label for="followUpReminderDate">Reminder Date:</label>
                    <input type="date" id="followUpReminderDate" min="2025-11-03">
                    <div class="error-message" id="followUpReminderDate-error"></div>
                    <label for="followUpNotes">Notes:</label>
                    <textarea id="followUpNotes" placeholder="Notes" maxlength="500"></textarea>
                    <div class="error-message" id="followUpNotes-error"></div>
                    <button type="submit">Log Follow-up</button>
                </form>
                <ul id="followUpList" class="follow-up-list">
                    <!-- Follow-ups will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('follow-ups')">Print</button>
                    <button class="export-btn" onclick="exportFollowUps()">Export</button>
                    <button class="email-btn" onclick="emailFollowUps()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('follow-ups')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="follow-up-reminders-folder">
            <summary>Follow-up Reminders (Enhanced)</summary>
            <div class="folder-content">
                <p><strong>Enhanced Features:</strong> Bulk send for due reminders, priority sorting, and customizable templates.</p>
                <button class="bulk-send-btn" onclick="bulkSendDueReminders()">Bulk Send Due Reminders Today</button>
                <ul id="reminderList" class="reminder-list">
                    <!-- Reminders will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('follow-up-reminders')">Print</button>
                    <button class="export-btn" onclick="exportReminders()">Export</button>
                    <button class="email-btn" onclick="emailReminders()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('follow-up-reminders')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="send-visitor-message-folder">
            <summary>Send Visitor Message</summary>
            <div class="folder-content">
                <form id="visitorWhatsAppForm" class="tithe-message-form" novalidate>
                    <label for="visitorWhatsAppSelect">Select Visitor:</label>
                    <select id="visitorWhatsAppSelect" required>
                        <option value="">Select Visitor</option>
                    </select>
                    <div class="error-message" id="visitorWhatsAppSelect-error"></div>
                    <label for="visitorWhatsAppMessage">Message:</label>
                    <textarea id="visitorWhatsAppMessage" placeholder="Enter your message..." required minlength="1" maxlength="1000"></textarea>
                    <div class="error-message" id="visitorWhatsAppMessage-error"></div>
                    <div class="template-buttons">
                        <button type="button" class="template-btn" onclick="fillVisitorTemplate('Welcome [Name]! We\'re glad you visited us. Join us next Sunday at 9 AM. God bless!')">Welcome Message</button>
                        <button type="button" class="template-btn" onclick="fillVisitorTemplate('Hello [Name], we have a visitor follow-up class on [Date]. Interested? Reply yes!')">Follow-up Invite</button>
                        <button type="button" class="template-btn" onclick="fillVisitorTemplate('Thank you [Name] for visiting. How can we pray for you today?')">Prayer Offer</button>
                        <button type="button" class="template-btn" onclick="fillVisitorTemplate('Hi [Name], here\'s our church newsletter: [Link]. Blessings!')">Newsletter Share</button>
                        <button type="button" class="ai-suggest-btn" onclick="generateAIMessage('visitor')">AI Suggest Message</button>
                    </div>
                    <button type="submit">Send via WhatsApp</button>
                </form>
            </div>
        </details>
        <button id="generateVisitorReportBtn" class="generate-report-btn">Generate Visitors Report ðŸ“Š</button>
    </div>

    <div id="analytics" class="content">
        <h2>Church Analytics Dashboard</h2>
        <div class="stats-grid">
            <!-- Visitor Stats -->
            <div class="stat-card">
                <div class="stat-number" id="totalVisitors">0</div>
                <div>Total Visitors</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalConverted">0</div>
                <div>Converted to Members</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="conversionRate">0%</div>
                <div>Conversion Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingFollowUps">0</div>
                <div>Pending Follow-ups</div>
            </div>
            <!-- Tithe & Offering Stats -->
            <div class="stat-card">
                <div class="stat-number" id="totalTithe">0</div>
                <div>Total Tithe</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalOffering">0</div>
                <div>Total Offering</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="averageTithe">0</div>
                <div>Average Tithe</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalAttendance">0</div>
                <div>Total Attendance</div>
            </div>
        </div>
        <div class="analytics-container">
            <div class="chart-container">
                <h3>Visitors Over Time</h3>
                <canvas id="visitorsChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Conversion Status</h3>
                <canvas id="conversionChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Tithe vs Offering Over Time</h3>
                <canvas id="titheChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Attendance Over Time</h3>
                <canvas id="attendanceChart"></canvas>
            </div>
        </div>
        <button class="generate-report-btn" onclick="generateAIInsights()">AI Insights</button>
    </div>

    <div id="events" class="content">
        <h2>Events Management</h2>
        <div class="bulk-upload">
            <h3>Bulk Upload Events</h3>
            <p>Supported: CSV, XLSX, PDF, DOCX. Format: title,description,date,branch,organizer</p>
            <div id="eventsFilePreview" class="file-preview"></div>
            <form id="bulkEventsForm">
                <input type="file" id="bulkEventsCsv" accept=".csv,.xlsx,.pdf,.docx" required>
                <button type="submit">Upload File</button>
            </form>
        </div>
        <div class="search-container">
            <h3>Search Events</h3>
            <input type="text" id="eventsSearch" placeholder="Search by title, date, or branch...">
        </div>
        <details id="events-folder">
            <summary>Events Directory</summary>
            <div class="folder-content">
                <form id="eventForm" novalidate>
                    <label for="eventTitle">Event Title:</label>
                    <input type="text" id="eventTitle" placeholder="Event Title" required minlength="3" maxlength="100">
                    <div class="error-message" id="eventTitle-error"></div>
                    <label for="eventDescription">Description:</label>
                    <textarea id="eventDescription" placeholder="Description" maxlength="500"></textarea>
                    <div class="error-message" id="eventDescription-error"></div>
                    <label for="eventDate">Date:</label>
                    <input type="date" id="eventDate" required min="2025-01-01" max="2026-12-31">
                    <div class="error-message" id="eventDate-error"></div>
                    <label for="eventBranch">Branch:</label>
                    <select id="eventBranch">
                        <option value="">Select Branch</option>
                        <option value="Khutsong">Khutsong</option>
                        <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                        <option value="Mahube">Mahube</option>
                        <option value="Phase 5">Phase 5</option>
                        <option value="Kwamhlanga">Kwamhlanga</option>
                        <option value="Kameel Port">Kameel Port</option>
                        <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                        <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                    </select>
                    <div class="error-message" id="eventBranch-error"></div>
                    <label for="eventOrganizer">Organizer:</label>
                    <input type="text" id="eventOrganizer" placeholder="Organizer" minlength="2" maxlength="100">
                    <div class="error-message" id="eventOrganizer-error"></div>
                    <button type="submit">Add Event</button>
                </form>
                <table id="eventTable">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Date</th>
                            <th>Branch</th>
                            <th>Organizer</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Events will be added here -->
                    </tbody>
                </table>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('events')">Print</button>
                    <button class="export-btn" onclick="exportEvents()">Export</button>
                    <button class="email-btn" onclick="emailEvents()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('events')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="conference-budgets-folder">
            <summary>Conference Budgets</summary>
            <div class="folder-content">
                <div class="budget-date">
                    <label for="budgetDate">Budget Date: </label>
                    <input type="date" id="budgetDate" value="2025-10-31" min="2025-01-01" max="2025-11-03">
                </div>
                <!-- September Conference -->
                <details>
                    <summary>September Conference</summary>
                    <div>
                        <h4>Transport</h4>
                        <table class="transport-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="september" data-category="transport" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Decoration (Deco)</h4>
                        <table class="stage-deco-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="september" data-category="deco" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Security</h4>
                        <table class="essentials-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="september" data-category="security" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Sound/Media</h4>
                        <table class="sound-media-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="september" data-category="sound-media" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Guest Pastor</h4>
                        <table class="guest-pastor-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="september" data-category="guest-pastor" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Grocery and Conference Essentials</h4>
                        <table class="grocery-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="september" data-category="grocery" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Sunday School</h4>
                        <table class="sunday-school-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="september" data-category="sunday-school" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <div class="budget-total" id="september-total">Total: $0.00</div>
                    </div>
                </details>
                <!-- Easter Conference -->
                <details>
                    <summary>Easter Conference</summary>
                    <div>
                        <h4>Transport</h4>
                        <table class="transport-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="easter" data-category="transport" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Decoration (Deco)</h4>
                        <table class="stage-deco-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="easter" data-category="deco" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Security</h4>
                        <table class="essentials-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="easter" data-category="security" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Sound/Media</h4>
                        <table class="sound-media-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="easter" data-category="sound-media" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Guest Pastor</h4>
                        <table class="guest-pastor-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="easter" data-category="guest-pastor" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Grocery and Conference Essentials</h4>
                        <table class="grocery-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="easter" data-category="grocery" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Sunday School</h4>
                        <table class="sunday-school-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="easter" data-category="sunday-school" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <div class="budget-total" id="easter-total">Total: $0.00</div>
                    </div>
                </details>
                <!-- Combined Service -->
                <details>
                    <summary>Combined Service</summary>
                    <div>
                        <h4>Combined Essentials</h4>
                        <table class="essentials-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="combined" data-category="essentials" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Transport</h4>
                        <table class="transport-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="combined" data-category="transport" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <h4>Sunday School</h4>
                        <table class="sunday-school-table">
                            <thead><tr><th>Amount</th></tr></thead>
                            <tbody><tr><td><input type="number" class="budget-input" data-event="combined" data-category="sunday-school" value="0" step="0.01" min="0"></td></tr></tbody>
                        </table>
                        <div class="budget-total" id="combined-total">Total: $0.00</div>
                    </div>
                </details>
                <div class="grand-total" id="grand-total">Grand Total: $0.00</div>
                <button class="generate-report-btn" onclick="saveBudgets()">Save Budgets</button>
                <button class="generate-report-btn" onclick="calculateTotals()">Calculate Totals</button>
            </div>
        </details>
    </div>

    <div id="tithe" class="content">
        <h2>Tithe & Offering</h2>
        <div class="bulk-upload">
            <h3>Bulk Upload Tithes/Offerings</h3>
            <p>Supported: CSV, XLSX, PDF, DOCX. Format: memberName,type,amount,date,branch</p>
            <div id="titheFilePreview" class="file-preview"></div>
            <form id="bulkTitheForm">
                <input type="file" id="bulkTitheCsv" accept=".csv,.xlsx,.pdf,.docx" required>
                <button type="submit">Upload File</button>
            </form>
        </div>
        <div class="search-container">
            <h3>Search Tithes</h3>
            <input type="text" id="titheSearch" placeholder="Search by member, type, or date...">
        </div>
        <form id="titheForm" novalidate>
            <label for="titheMemberSelect">Member:</label>
            <select id="titheMemberSelect" required>
                <option value="">Select Member</option>
            </select>
            <div class="error-message" id="titheMemberSelect-error"></div>
            <label for="titheType">Type:</label>
            <select id="titheType" required>
                <option value="">Select Type</option>
                <option value="Tithe">Tithe</option>
                <option value="Offering">Offering</option>
            </select>
            <div class="error-message" id="titheType-error"></div>
            <label for="titheAmount">Amount:</label>
            <input type="number" id="titheAmount" placeholder="Amount" step="0.01" required min="0.01" max="10000">
            <div class="error-message" id="titheAmount-error"></div>
            <label for="titheDate">Date:</label>
            <input type="date" id="titheDate" required max="2025-11-03">
            <div class="error-message" id="titheDate-error"></div>
            <label for="titheBranch">Branch:</label>
            <select id="titheBranch">
                <option value="">Select Branch</option>
                <option value="Khutsong">Khutsong</option>
                <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                <option value="Mahube">Mahube</option>
                <option value="Phase 5">Phase 5</option>
                <option value="Kwamhlanga">Kwamhlanga</option>
                <option value="Kameel Port">Kameel Port</option>
                <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
            </select>
            <div class="error-message" id="titheBranch-error"></div>
            <button type="submit">Record Tithe/Offering</button>
        </form>
        <table id="titheTable">
            <thead>
                <tr>
                    <th>Member Name</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Branch</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Tithes will be added here -->
            </tbody>
        </table>
        <div class="total">Total Tithe: $<span id="totalTitheDisplay">0.00</span> | Total Offering: $<span id="totalOfferingDisplay">0.00</span></div>
        <button id="generateTitheReportBtn" class="generate-report-btn">Generate Tithe Report ðŸ“Š</button>
        <!-- Advanced Payment Gateway Integration with PayPal -->
        <button class="generate-report-btn" onclick="openPaymentModal()">Donate Online (Stripe or PayPal)</button>
        <div class="folder-actions">
            <button class="print-btn" onclick="printTithes()">Print</button>
            <button class="export-btn" onclick="exportTithes()">Export</button>
            <button class="email-btn" onclick="emailTithes()">Email</button>
        </div>
    </div>

    <div id="church-admin" class="content">
        <h2>Church Admin</h2>
        <div class="leaders-container">
            <div class="leaders-section">
                <details id="ministry-leaders-folder">
                    <summary>Ministry Leaders</summary>
                    <div class="folder-content">
                        <form id="ministryLeaderForm" novalidate>
                            <label for="ministryLeaderName">Full Name:</label>
                            <input type="text" id="ministryLeaderName" placeholder="Full Name" required minlength="2" maxlength="100">
                            <div class="error-message" id="ministryLeaderName-error"></div>
                            <label for="ministryLeaderBranch">Branch:</label>
                            <select id="ministryLeaderBranch" required>
                                <option value="">Select Branch</option>
                                <option value="Khutsong">Khutsong</option>
                                <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                                <option value="Mahube">Mahube</option>
                                <option value="Phase 5">Phase 5</option>
                                <option value="Kwamhlanga">Kwamhlanga</option>
                                <option value="Kameel Port">Kameel Port</option>
                                <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                                <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                            </select>
                            <div class="error-message" id="ministryLeaderBranch-error"></div>
                            <label for="ministryLeaderEmail">Email:</label>
                            <input type="email" id="ministryLeaderEmail" placeholder="Email" required>
                            <div class="error-message" id="ministryLeaderEmail-error"></div>
                            <label for="ministryLeaderCell">Cell Number:</label>
                            <input type="tel" id="ministryLeaderCell" placeholder="Cell Number" required pattern="[+]?[0-9\s\-\(\)]{10,}" title="Enter a valid phone number (at least 10 digits)">
                            <div class="error-message" id="ministryLeaderCell-error"></div>
                            <label for="ministryLeaderMinistry">Ministry:</label>
                            <input type="text" id="ministryLeaderMinistry" placeholder="Ministry" required minlength="2" maxlength="50">
                            <div class="error-message" id="ministryLeaderMinistry-error"></div>
                            <button type="submit">Add Ministry Leader</button>
                        </form>
                        <table id="ministryLeaderTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Branch</th>
                                    <th>Email</th>
                                    <th>Cell</th>
                                    <th>Ministry</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Ministry Leaders will be added here -->
                            </tbody>
                        </table>
                        <div class="folder-actions">
                            <button class="print-btn" onclick="printFolder('ministry-leaders')">Print</button>
                            <button class="export-btn" onclick="exportMinistryLeaders()">Export</button>
                            <button class="email-btn" onclick="emailMinistryLeaders()">Email</button>
                            <button class="minimize-btn" onclick="toggleFolder('ministry-leaders')">Minimize</button>
                        </div>
                    </div>
                </details>
            </div>
            <div class="leaders-section">
                <details id="cell-leaders-folder">
                    <summary>Cell Leaders</summary>
                    <div class="folder-content">
                        <form id="cellLeaderForm" novalidate>
                            <label for="cellLeaderName">Full Name:</label>
                            <input type="text" id="cellLeaderName" placeholder="Full Name" required minlength="2" maxlength="100">
                            <div class="error-message" id="cellLeaderName-error"></div>
                            <label for="cellLeaderBranch">Branch:</label>
                            <select id="cellLeaderBranch" required>
                                <option value="">Select Branch</option>
                                <option value="Khutsong">Khutsong</option>
                                <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                                <option value="Mahube">Mahube</option>
                                <option value="Phase 5">Phase 5</option>
                                <option value="Kwamhlanga">Kwamhlanga</option>
                                <option value="Kameel Port">Kameel Port</option>
                                <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                                <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                            </select>
                            <div class="error-message" id="cellLeaderBranch-error"></div>
                            <label for="cellLeaderEmail">Email:</label>
                            <input type="email" id="cellLeaderEmail" placeholder="Email" required>
                            <div class="error-message" id="cellLeaderEmail-error"></div>
                            <label for="cellLeaderCell">Cell Number:</label>
                            <input type="tel" id="cellLeaderCell" placeholder="Cell Number" required pattern="[+]?[0-9\s\-\(\)]{10,}" title="Enter a valid phone number (at least 10 digits)">
                            <div class="error-message" id="cellLeaderCell-error"></div>
                            <label for="cellLeaderCellGroup">Cell Group:</label>
                            <input type="text" id="cellLeaderCellGroup" placeholder="Cell Group" required minlength="2" maxlength="50">
                            <div class="error-message" id="cellLeaderCellGroup-error"></div>
                            <button type="submit">Add Cell Leader</button>
                        </form>
                        <table id="cellLeaderTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Branch</th>
                                    <th>Email</th>
                                    <th>Cell</th>
                                    <th>Cell Group</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Cell Leaders will be added here -->
                            </tbody>
                        </table>
                        <div class="folder-actions">
                            <button class="print-btn" onclick="printFolder('cell-leaders')">Print</button>
                            <button class="export-btn" onclick="exportCellLeaders()">Export</button>
                            <button class="email-btn" onclick="emailCellLeaders()">Email</button>
                            <button class="minimize-btn" onclick="toggleFolder('cell-leaders')">Minimize</button>
                        </div>
                    </div>
                </details>
            </div>
            <div class="leaders-section">
                <details id="elder-folder">
                    <summary>Elders</summary>
                    <div class="folder-content">
                        <form id="elderForm" novalidate>
                            <label for="elderName">Full Name:</label>
                            <input type="text" id="elderName" placeholder="Full Name" required minlength="2" maxlength="100">
                            <div class="error-message" id="elderName-error"></div>
                            <label for="elderBranch">Branch:</label>
                            <select id="elderBranch" required>
                                <option value="">Select Branch</option>
                                <option value="Khutsong">Khutsong</option>
                                <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                                <option value="Mahube">Mahube</option>
                                <option value="Phase 5">Phase 5</option>
                                <option value="Kwamhlanga">Kwamhlanga</option>
                                <option value="Kameel Port">Kameel Port</option>
                                <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                                <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                            </select>
                            <div class="error-message" id="elderBranch-error"></div>
                            <label for="elderEmail">Email:</label>
                            <input type="email" id="elderEmail" placeholder="Email" required>
                            <div class="error-message" id="elderEmail-error"></div>
                            <label for="elderCell">Cell Number:</label>
                            <input type="tel" id="elderCell" placeholder="Cell Number" required pattern="[+]?[0-9\s\-\(\)]{10,}" title="Enter a valid phone number (at least 10 digits)">
                            <div class="error-message" id="elderCell-error"></div>
                            <label for="elderOrdinationDate">Ordination Date:</label>
                            <input type="date" id="elderOrdinationDate" required max="2025-11-03">
                            <div class="error-message" id="elderOrdinationDate-error"></div>
                            <button type="submit">Add Elder</button>
                        </form>
                        <table id="elderTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Branch</th>
                                    <th>Email</th>
                                    <th>Cell</th>
                                    <th>Ordination Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Elders will be added here -->
                            </tbody>
                        </table>
                        <div class="folder-actions">
                            <button class="print-btn" onclick="printFolder('elder')">Print</button>
                            <button class="export-btn" onclick="exportElders()">Export</button>
                            <button class="email-btn" onclick="emailElders()">Email</button>
                            <button class="minimize-btn" onclick="toggleFolder('elder')">Minimize</button>
                        </div>
                    </div>
                </details>
            </div>
            <div class="leaders-section">
                <details id="pastor-folder">
                    <summary>Pastors</summary>
                    <div class="folder-content">
                        <form id="pastorForm" novalidate>
                            <label for="pastorName">Full Name:</label>
                            <input type="text" id="pastorName" placeholder="Full Name" required minlength="2" maxlength="100">
                            <div class="error-message" id="pastorName-error"></div>
                            <label for="pastorBranch">Branch:</label>
                            <select id="pastorBranch" required>
                                <option value="">Select Branch</option>
                                <option value="Khutsong">Khutsong</option>
                                <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                                <option value="Mahube">Mahube</option>
                                <option value="Phase 5">Phase 5</option>
                                <option value="Kwamhlanga">Kwamhlanga</option>
                                <option value="Kameel Port">Kameel Port</option>
                                <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                                <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                            </select>
                            <div class="error-message" id="pastorBranch-error"></div>
                            <label for="pastorEmail">Email:</label>
                            <input type="email" id="pastorEmail" placeholder="Email" required>
                            <div class="error-message" id="pastorEmail-error"></div>
                            <label for="pastorCell">Cell Number:</label>
                            <input type="tel" id="pastorCell" placeholder="Cell Number" required pattern="[+]?[0-9\s\-\(\)]{10,}" title="Enter a valid phone number (at least 10 digits)">
                            <div class="error-message" id="pastorCell-error"></div>
                            <label for="pastorAppointmentDate">Appointment Date:</label>
                            <input type="date" id="pastorAppointmentDate" required max="2025-11-03">
                            <div class="error-message" id="pastorAppointmentDate-error"></div>
                            <button type="submit">Add Pastor</button>
                        </form>
                        <table id="pastorTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Branch</th>
                                    <th>Email</th>
                                    <th>Cell</th>
                                    <th>Appointment Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Pastors will be added here -->
                            </tbody>
                        </table>
                        <div class="folder-actions">
                            <button class="print-btn" onclick="printFolder('pastor')">Print</button>
                            <button class="export-btn" onclick="exportPastors()">Export</button>
                            <button class="email-btn" onclick="emailPastors()">Email</button>
                            <button class="minimize-btn" onclick="toggleFolder('pastor')">Minimize</button>
                        </div>
                    </div>
                </details>
            </div>
            <div class="leaders-section">
                <details id="branch-coordinator-folder">
                    <summary>Branch Coordinators</summary>
                    <div class="folder-content">
                        <form id="branchCoordForm" novalidate>
                            <label for="branchCoordName">Full Name:</label>
                            <input type="text" id="branchCoordName" placeholder="Full Name" required minlength="2" maxlength="100">
                            <div class="error-message" id="branchCoordName-error"></div>
                            <label for="branchCoordBranch">Branch:</label>
                            <select id="branchCoordBranch" required>
                                <option value="">Select Branch</option>
                                <option value="Khutsong">Khutsong</option>
                                <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                                <option value="Mahube">Mahube</option>
                                <option value="Phase 5">Phase 5</option>
                                <option value="Kwamhlanga">Kwamhlanga</option>
                                <option value="Kameel Port">Kameel Port</option>
                                <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                                <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                            </select>
                            <div class="error-message" id="branchCoordBranch-error"></div>
                            <label for="branchCoordEmail">Email:</label>
                            <input type="email" id="branchCoordEmail" placeholder="Email" required>
                            <div class="error-message" id="branchCoordEmail-error"></div>
                            <label for="branchCoordCell">Cell Number:</label>
                            <input type="tel" id="branchCoordCell" placeholder="Cell Number" required pattern="[+]?[0-9\s\-\(\)]{10,}" title="Enter a valid phone number (at least 10 digits)">
                            <div class="error-message" id="branchCoordCell-error"></div>
                            <label for="branchCoordNotes">Notes:</label>
                            <textarea id="branchCoordNotes" placeholder="Notes" maxlength="500"></textarea>
                            <div class="error-message" id="branchCoordNotes-error"></div>
                            <button type="submit">Add Branch Coordinator</button>
                        </form>
                        <table id="branchCoordTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Branch</th>
                                    <th>Email</th>
                                    <th>Cell</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Branch Coordinators will be added here -->
                            </tbody>
                        </table>
                        <div class="folder-actions">
                            <button class="print-btn" onclick="printFolder('branch-coordinator')">Print</button>
                            <button class="export-btn" onclick="exportBranchCoordinators()">Export</button>
                            <button class="email-btn" onclick="emailBranchCoordinators()">Email</button>
                            <button class="minimize-btn" onclick="toggleFolder('branch-coordinator')">Minimize</button>
                        </div>
                    </div>
                </details>
            </div>
        </div>
    </div>

    <div id="attendance" class="content">
        <h2>Church Attendance</h2>
        <div class="bulk-upload">
            <h3>Bulk Upload Attendance</h3>
            <p>Supported: CSV, XLSX, PDF, DOCX. Format: branch,date,youth,adult,sundaySchool</p>
            <div id="attendanceFilePreview" class="file-preview"></div>
            <form id="bulkAttendanceForm">
                <input type="file" id="bulkAttendanceCsv" accept=".csv,.xlsx,.pdf,.docx" required>
                <button type="submit">Upload File</button>
            </form>
        </div>
        <div class="search-container">
            <h3>Search Attendance</h3>
            <input type="text" id="attendanceSearch" placeholder="Search by branch or date...">
        </div>
        <form id="attendanceForm" novalidate class="attendance-form">
            <label for="attendanceBranch">Branch:</label>
            <select id="attendanceBranch" required>
                <option value="">Select Branch</option>
                <option value="Khutsong">Khutsong</option>
                <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                <option value="Mahube">Mahube</option>
                <option value="Phase 5">Phase 5</option>
                <option value="Kwamhlanga">Kwamhlanga</option>
                <option value="Kameel Port">Kameel Port</option>
                <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
            </select>
            <div class="error-message" id="attendanceBranch-error"></div>
            <label for="attendanceDate">Date:</label>
            <input type="date" id="attendanceDate" required max="2025-11-03">
            <div class="error-message" id="attendanceDate-error"></div>
            <label for="youthAttendance">Youth Attendance:</label>
            <input type="number" id="youthAttendance" min="0" required>
            <div class="error-message" id="youthAttendance-error"></div>
            <label for="adultAttendance">Adult Attendance:</label>
            <input type="number" id="adultAttendance" min="0" required>
            <div class="error-message" id="adultAttendance-error"></div>
            <label for="sundaySchoolAttendance">Sunday School Attendance:</label>
            <input type="number" id="sundaySchoolAttendance" min="0" required>
            <div class="error-message" id="sundaySchoolAttendance-error"></div>
            <button type="submit">Log Attendance</button>
        </form>
        <table id="attendanceTable">
            <thead>
                <tr>
                    <th>Branch</th>
                    <th>Date</th>
                    <th>Youth</th>
                    <th>Adult</th>
                    <th>Sunday School</th>
                    <th>Total</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Attendance will be added here -->
            </tbody>
        </table>
        <div class="folder-actions">
            <button class="print-btn" onclick="printAttendance()">Print</button>
            <button class="export-btn" onclick="exportAttendance()">Export</button>
            <button class="email-btn" onclick="emailAttendance()">Email</button>
        </div>
    </div>

    <div id="whatsapp" class="content">
        <h2>WhatsApp Interactions</h2>
        <details id="whatsapp-broadcast-folder">
            <summary>Broadcast Messages</summary>
            <div class="folder-content">
                <form id="broadcastForm" class="broadcast-form" novalidate>
                    <label for="broadcastSelect">Select Recipients:</label>
                    <select id="broadcastSelect" multiple class="broadcast-select" required>
                        <!-- Recipients will be populated here -->
                    </select>
                    <div class="error-message" id="broadcastSelect-error"></div>
                    <label for="broadcastMessage">Message:</label>
                    <textarea id="broadcastMessage" placeholder="Enter broadcast message..." required minlength="1" maxlength="1000"></textarea>
                    <div class="error-message" id="broadcastMessage-error"></div>
                    <div class="broadcast-actions">
                        <button type="button" class="broadcast-btn" onclick="sendBroadcast()">Send Broadcast</button>
                        <button type="button" class="broadcast-btn" onclick="scheduleBroadcast()">Schedule</button>
                        <button type="button" class="ai-suggest-btn" onclick="generateAIMessage('broadcast')">AI Suggest</button>
                    </div>
                </form>
                <ul id="whatsappList" class="whatsapp-list">
                    <!-- History will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('whatsapp-broadcast')">Print</button>
                    <button class="export-btn" onclick="exportWhatsApp()">Export</button>
                    <button class="email-btn" onclick="emailWhatsApp()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('whatsapp-broadcast')">Minimize</button>
                </div>
            </div>
        </details>
    </div>

    <div id="vault" class="content">
        <h2>Vault</h2>
        <details id="conference-reports-folder">
            <summary>Conference Reports</summary>
            <div class="folder-content">
                <form id="conferenceReportForm" novalidate>
                    <label for="conferenceReportTitle">Title:</label>
                    <input type="text" id="conferenceReportTitle" required minlength="3" maxlength="100">
                    <div class="error-message" id="conferenceReportTitle-error"></div>
                    <label for="conferenceReportContent">Content:</label>
                    <textarea id="conferenceReportContent" required minlength="10" maxlength="2000"></textarea>
                    <div class="error-message" id="conferenceReportContent-error"></div>
                    <label for="conferenceReportDate">Date:</label>
                    <input type="date" id="conferenceReportDate" max="2025-11-03">
                    <div class="error-message" id="conferenceReportDate-error"></div>
                    <button type="submit">Add Report</button>
                </form>
                <ul id="conferenceReportList" class="report-list">
                    <!-- Reports will be added here -->
                </ul>
                <div class="conference-file-upload">
                    <h4>Upload Conference Files</h4>
                    <form id="conferenceReportUploadForm" novalidate>
                        <label for="fileReportTitle">File Title:</label>
                        <input type="text" id="fileReportTitle" required minlength="3" maxlength="100">
                        <div class="error-message" id="fileReportTitle-error"></div>
                        <label for="conferenceReportFile">File:</label>
                        <input type="file" id="conferenceReportFile" accept=".pdf,.docx,.xlsx" required>
                        <div class="error-message" id="conferenceReportFile-error"></div>
                        <button type="submit">Upload File</button>
                    </form>
                </div>
                <ul id="conferenceReportFileList" class="report-list">
                    <!-- Files will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('conference-reports')">Print</button>
                    <button class="export-btn" onclick="exportConferenceReports()">Export</button>
                    <button class="email-btn" onclick="emailConferenceReports()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('conference-reports')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="tithe-reports-folder">
            <summary>Tithe Reports</summary>
            <div class="folder-content">
                <form id="titheReportForm" novalidate>
                    <label for="titheReportTitle">Title:</label>
                    <input type="text" id="titheReportTitle" required minlength="3" maxlength="100">
                    <div class="error-message" id="titheReportTitle-error"></div>
                    <label for="titheReportContent">Content:</label>
                    <textarea id="titheReportContent" required minlength="10" maxlength="2000"></textarea>
                    <div class="error-message" id="titheReportContent-error"></div>
                    <label for="titheReportDate">Date:</label>
                    <input type="date" id="titheReportDate" max="2025-11-03">
                    <div class="error-message" id="titheReportDate-error"></div>
                    <button type="submit">Add Report</button>
                </form>
                <ul id="titheReportList" class="report-list">
                    <!-- Reports will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('tithe-reports')">Print</button>
                    <button class="export-btn" onclick="exportTitheReports()">Export</button>
                    <button class="email-btn" onclick="emailTitheReports()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('tithe-reports')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="visitors-reports-folder">
            <summary>Visitors Reports</summary>
            <div class="folder-content">
                <form id="visitorsReportForm" novalidate>
                    <label for="visitorsReportTitle">Title:</label>
                    <input type="text" id="visitorsReportTitle" required minlength="3" maxlength="100">
                    <div class="error-message" id="visitorsReportTitle-error"></div>
                    <label for="visitorsReportContent">Content:</label>
                    <textarea id="visitorsReportContent" required minlength="10" maxlength="2000"></textarea>
                    <div class="error-message" id="visitorsReportContent-error"></div>
                    <label for="visitorsReportDate">Date:</label>
                    <input type="date" id="visitorsReportDate" max="2025-11-03">
                    <div class="error-message" id="visitorsReportDate-error"></div>
                    <button type="submit">Add Report</button>
                </form>
                <ul id="visitorsReportList" class="report-list">
                    <!-- Reports will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('visitors-reports')">Print</button>
                    <button class="export-btn" onclick="exportVisitorsReports()">Export</button>
                    <button class="email-btn" onclick="emailVisitorsReports()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('visitors-reports')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="secure-notes-folder">
            <summary>Secure Notes</summary>
            <div class="folder-content">
                <form id="vaultForm" novalidate>
                    <label for="vaultTitle">Title:</label>
                    <input type="text" id="vaultTitle" required minlength="3" maxlength="100">
                    <div class="error-message" id="vaultTitle-error"></div>
                    <label for="vaultContent">Content:</label>
                    <textarea id="vaultContent" required minlength="10" maxlength="2000"></textarea>
                    <div class="error-message" id="vaultContent-error"></div>
                    <button type="submit">Add Secure Note</button>
                </form>
                <ul id="vaultList" class="report-list">
                    <!-- Notes will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('secure-notes')">Print</button>
                    <button class="export-btn" onclick="exportVault()">Export</button>
                    <button class="email-btn" onclick="emailVault()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('secure-notes')">Minimize</button>
                </div>
            </div>
        </details>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal">
        <div class="payment-modal-content">
            <span onclick="closePaymentModal()" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
            <h3>Donate Online</h3>
            <form id="paymentForm" novalidate>
                <label for="donationAmount">Amount ($):</label>
                <input type="number" id="donationAmount" step="0.01" min="1" required>
                <div class="error-message" id="donationAmount-error"></div>
                <label for="donorName">Name:</label>
                <input type="text" id="donorName" required>
                <div class="error-message" id="donorName-error"></div>
                <label for="donorEmail">Email:</label>
                <input type="email" id="donorEmail" required>
                <div class="error-message" id="donorEmail-error"></div>
                <div class="recurring-option">
                    <label><input type="radio" name="recurring" value="one-time" checked> One-time</label>
                    <label><input type="radio" name="recurring" value="monthly"> Monthly</label>
                </div>
                <div>
                    <label><input type="radio" name="paymentMethod" value="stripe" checked> Stripe</label>
                    <label><input type="radio" name="paymentMethod" value="paypal"> PayPal</label>
                </div>
                <div id="stripe-payment" class="payment-method active">
                    <div id="card-element"></div>
                    <div id="card-errors"></div>
                </div>
                <div id="paypal-payment" class="payment-method">
                    <div id="paypal-button-container"></div>
                </div>
                <button type="submit">Donate</button>
            </form>
        </div>
    </div>

    <!-- File Viewer Modal -->
    <div id="fileViewerModal">
        <div class="file-viewer-content" id="fileViewerContent">
            <span class="close-viewer" onclick="closeFileViewer()">&times;</span>
            <div id="viewerToolbar" class="viewer-toolbar" style="display:none;">
                <div class="pdf-page-nav" id="pdfNav" style="display:none;">
                    <button onclick="prevPage()">Prev</button>
                    <span id="pageInfo">1 / 1</span>
                    <button onclick="nextPage()">Next</button>
                </div>
                <div class="zoom-controls">
                    <button onclick="zoomOut()">-</button>
                    <input type="number" id="zoomLevel" min="50" max="200" value="100" onchange="setZoom(this.value)">
                    <button onclick="zoomIn()">+</button>
                </div>
            </div>
            <div class="viewer-loading">Loading...</div>
        </div>
    </div>

    <!-- AI Suggestion Overlay -->
    <div id="ai-suggestion">
        <h4>AI Suggestion</h4>
        <p id="ai-message"></p>
        <button onclick="useAISuggestion()">Use</button>
        <button onclick="closeAISuggestion()">Cancel</button>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Data stores (localStorage based)
        let members = loadData('members', []);
        let visitors = loadData('visitors', []);
        let events = loadData('events', []);
        let tithes = loadData('tithes', []);
        let ministryLeaders = loadData('ministryLeaders', []);
        let cellLeaders = loadData('cellLeaders', []);
        let elders = loadData('elders', []);
        let pastors = loadData('pastors', []);
        let branchCoordinators = loadData('branchCoordinators', []);
        let attendance = loadData('attendance', []);
        let whatsappHistory = loadData('whatsappHistory', []);
        let followUps = loadData('followUps', []);
        let reminders = loadData('reminders', []);
        let conferenceReports = loadData('conferenceReports', []);
        let conferenceReportFiles = loadData('conferenceReportFiles', []);
        let titheReports = loadData('titheReports', []);
        let visitorsReports = loadData('visitorsReports', []);
        let vault = loadData('vault', []);
        let conferenceBudgets = loadData('conferenceBudgets', { september: {}, easter: {}, combined: {} });

        // Utility functions
        function loadData(key, defaultValue) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                return defaultValue;
            }
        }

        function saveData(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Save error:', e);
            }
        }

        function addData(key, item) {
            const data = loadData(key, []);
            item.id = Date.now();
            data.push(item);
            saveData(key, data);
            return item;
        }

        function updateData(key, id, updates) {
            const data = loadData(key, []);
            const index = data.findIndex(item => item.id === id);
            if (index !== -1) {
                data[index] = { ...data[index], ...updates };
                saveData(key, data);
            }
        }

        function deleteData(key, id) {
            const data = loadData(key, []);
            const newData = data.filter(item => item.id !== id);
            saveData(key, newData);
        }

        function calculateTotal(data, filterFn = () => true) {
            return data.filter(filterFn).reduce((sum, item) => sum + parseFloat(item.amount || 0), 0).toFixed(2);
        }

        function showSection(section, btn) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            btn.classList.add('active');
            if (section === 'analytics') updateAnalytics();
            if (section === 'tithe') {
                populateTitheMemberSelect();
                renderTithes();
            }
            if (section === 'members') renderMembers();
            if (section === 'visitors') {
                populateFollowUpVisitorSelect();
                populateVisitorWhatsAppSelect();
                renderVisitors();
                renderFollowUps();
                renderReminders();
            }
            if (section === 'events') renderEvents();
            if (section === 'church-admin') {
                renderMinistryLeaders();
                renderCellLeaders();
                renderElders();
                renderPastors();
                renderBranchCoordinators();
            }
            if (section === 'attendance') renderAttendance();
            if (section === 'whatsapp') {
                populateBroadcastSelect();
                renderWhatsAppHistory();
            }
            if (section === 'vault') {
                renderConferenceReports();
                renderConferenceReportFiles();
                renderTitheReports();
                renderVisitorsReports();
                renderVault();
            }
        }

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = `notification show ${type === 'error' ? 'error' : ''}`;
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        function validateForm(formId) {
            const form = document.getElementById(formId);
            const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
            let valid = true;
            inputs.forEach(input => {
                if (!input.checkValidity()) {
                    const errorDiv = document.getElementById(input.id + '-error');
                    if (errorDiv) {
                        errorDiv.textContent = input.validationMessage;
                        errorDiv.classList.add('show');
                    }
                    input.style.borderColor = '#dc3545';
                    valid = false;
                } else {
                    input.style.borderColor = '#28a745';
                }
            });
            return valid;
        }

        function debounce(fn, delay = 300) {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => fn(...args), delay);
            };
        }

        // Enhanced Bulk Upload with AI Identification (Fuzzy matching for column headers, auto-categorization)
        async function handleBulkUpload(formId, dataKey, expectedFields, previewId) {
            const form = document.getElementById(formId);
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!validateForm(formId)) return;
                const file = form.querySelector('input[type="file"]').files[0];
                if (!file) return showNotification('No file selected!', 'error');

                const preview = document.getElementById(previewId);
                preview.innerHTML = '<p>Loading preview...</p>';
                preview.style.display = 'block';

                let parsedData = [];
                const fileType = file.name.split('.').pop().toLowerCase();

                try {
                    if (fileType === 'csv') {
                        const text = await file.text();
                        const rows = text.split('\n').map(row => row.split(','));
                        parsedData = rows.slice(1); // Skip header
                        // AI Enhancement: Fuzzy match headers
                        const headers = rows[0];
                        const mappedHeaders = expectedFields.map(field => {
                            const match = fuzzysort.go(field, headers, { limit: 1 });
                            return match[0] ? match[0].obj : field;
                        });
                        preview.innerHTML = `<table><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>${parsedData.slice(0,5).map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('')}</table><p>... (${parsedData.length} rows)</p>`;
                    } else if (fileType === 'xlsx') {
                        const arrayBuffer = await file.arrayBuffer();
                        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                        parsedData = json.slice(1);
                        const headers = json[0];
                        // AI Enhancement: Auto-categorize based on fuzzy match
                        parsedData = parsedData.map(row => {
                            const obj = {};
                            expectedFields.forEach((field, i) => {
                                const match = fuzzysort.go(field, headers, { limit: 1 });
                                if (match[0]) {
                                    const colIndex = headers.indexOf(match[0].obj);
                                    obj[field] = row[colIndex] || '';
                                }
                            });
                            return obj;
                        });
                        preview.innerHTML = `<table><tr>${headers.slice(0, expectedFields.length).map(h => `<th>${h}</th>`).join('')}</tr>${parsedData.slice(0,5).map(row => `<tr>${expectedFields.map(f => `<td>${row[f] || ''}</td>`).join('')}</tr>`).join('')}</table><p>... (${parsedData.length} rows)</p>`;
                    } else if (fileType === 'pdf') {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        let text = '';
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const content = await page.getTextContent();
                            text += content.items.map(item => item.str).join(' ') + '\n';
                        }
                        // AI Enhancement: Simple text parsing for fields (regex-based identification)
                        parsedData = text.split('\n').filter(line => line.trim()).map(line => {
                            const obj = {};
                            expectedFields.forEach(field => {
                                const regex = new RegExp(field + `[:\\s]+(.+?)(?=\\s|$|,)`, 'i');
                                const match = line.match(regex);
                                if (match) obj[field] = match[1].trim();
                            });
                            return obj;
                        }).filter(obj => Object.keys(obj).length > 0);
                        preview.innerHTML = `<p>Extracted ${parsedData.length} records from PDF.</p><pre>${JSON.stringify(parsedData.slice(0,3), null, 2)}</pre>`;
                    } else if (fileType === 'docx') {
                        const arrayBuffer = await file.arrayBuffer();
                        const result = await mammoth.convertToHtml({ arrayBuffer });
                        const text = result.value.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ');
                        parsedData = text.split('\n').filter(line => line.trim()).map(line => {
                            const obj = {};
                            expectedFields.forEach(field => {
                                const regex = new RegExp(field + `[:\\s]+(.+?)(?=\\s|$|,)`, 'i');
                                const match = line.match(regex);
                                if (match) obj[field] = match[1].trim();
                            });
                            return obj;
                        }).filter(obj => Object.keys(obj).length > 0);
                        preview.innerHTML = `<p>Extracted ${parsedData.length} records from DOCX.</p><pre>${JSON.stringify(parsedData.slice(0,3), null, 2)}</pre>`;
                    }

                    // Confirm upload
                    if (confirm(`Upload ${parsedData.length} records?`)) {
                        parsedData.forEach(item => addData(dataKey, item));
                        showNotification(`${parsedData.length} records uploaded!`);
                        form.reset();
                        preview.style.display = 'none';
                        // Re-render relevant section
                        if (dataKey === 'members') renderMembers();
                        if (dataKey === 'visitors') renderVisitors();
                        if (dataKey === 'tithes') renderTithes();
                        if (dataKey === 'events') renderEvents();
                        if (dataKey === 'attendance') renderAttendance();
                    }
                } catch (error) {
                    showNotification('Upload failed: ' + error.message, 'error');
                    preview.innerHTML = '<p>Error loading file.</p>';
                }
            });
        }

        // AI Integration Functions
        function generateAIMessage(type) {
            const suggestions = {
                visitor: [
                    'Welcome! We hope you felt the presence of God today. How can we support your faith journey?',
                    'Based on your visit, we recommend our upcoming Bible study on [topic]. Join us?',
                    'Prayer request? Reply with your needs, and our team will pray for you.'
                ],
                broadcast: [
                    'Church family, join us for prayer this Sunday at 9 AM. Your presence matters!',
                    'Reminder: Tithe deadline approaching. Blessings await those who give cheerfully.',
                    'AI Tip: Engagement low? Add a question to spark replies.'
                ]
            };
            const random = suggestions[type][Math.floor(Math.random() * suggestions[type].length)];
            document.getElementById('ai-message').textContent = random;
            document.getElementById('ai-suggestion').style.display = 'block';
        }

        function useAISuggestion() {
            const message = document.getElementById('ai-message').textContent;
            const activeForm = document.querySelector('.content.active form textarea');
            if (activeForm) activeForm.value = message;
            closeAISuggestion();
        }

        function closeAISuggestion() {
            document.getElementById('ai-suggestion').style.display = 'none';
        }

        function generateAIInsights() {
            // Simple AI-like analysis
            const insights = [];
            if (visitors.length > tithes.length / 2) insights.push('High visitor engagement â€“ consider more follow-ups.');
            if (calculateTotal(tithes, t => t.type === 'Tithe') < 1000) insights.push('Tithe below average â€“ AI suggests targeted giving campaign.');
            showNotification('AI Insights: ' + insights.join(' '));
        }

        // Enhanced Search with Fuzzy Matching
        function enhancedSearch(inputId, tableId, data, fields) {
            const input = document.getElementById(inputId);
            input.addEventListener('input', debounce((e) => {
                const term = e.target.value.toLowerCase();
                const rows = document.querySelectorAll(`${tableId} tbody tr`);
                if (!term) {
                    rows.forEach(row => row.style.display = '');
                    return;
                }
                const results = fuzzysort.go(term, data, { keys: fields });
                const visibleIds = results.map(r => r.obj.id);
                rows.forEach(row => {
                    row.style.display = visibleIds.includes(parseInt(row.dataset.id)) ? '' : 'none';
                });
            }));
        }

        // Render Functions
        function renderMembers() {
            const tbody = document.querySelector('#memberTable tbody');
            tbody.innerHTML = '';
            members.forEach(member => {
                const row = document.createElement('tr');
                row.dataset.id = member.id;
                row.innerHTML = `
                    <td>${member.name || ''}</td>
                    <td>${member.branch || ''}</td>
                    <td>${member.email || ''}</td>
                    <td>${member.cell || ''}</td>
                    <td>${member.address || ''}</td>
                    <td>${member.joinDate || ''}</td>
                    <td>${member.role || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderVisitors() {
            const tbody = document.querySelector('#visitorTable tbody');
            tbody.innerHTML = '';
            visitors.forEach(visitor => {
                const row = document.createElement('tr');
                row.dataset.id = visitor.id;
                row.innerHTML = `
                    <td>${visitor.name || ''}</td>
                    <td>${visitor.branch || ''}</td>
                    <td>${visitor.email || ''}</td>
                    <td>${visitor.cell || ''}</td>
                    <td>${visitor.address || ''}</td>
                    <td>${visitor.visitDate || ''}</td>
                    <td>${visitor.notes || ''}</td>
                    <td class="${visitor.status === 'Converted' ? 'converted' : ''}">${visitor.status || 'Pending'}</td>
                    <td>
                        <button class="convert-btn" onclick="convertVisitorToMember(${visitor.id})">Convert to Member</button>
                        <button class="delete-btn" onclick="deleteData('visitors', ${visitor.id}); renderVisitors();">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderEvents() {
            const tbody = document.querySelector('#eventTable tbody');
            tbody.innerHTML = '';
            events.forEach(event => {
                const row = document.createElement('tr');
                row.dataset.id = event.id;
                row.innerHTML = `
                    <td>${event.title || ''}</td>
                    <td>${event.description || ''}</td>
                    <td>${event.date || ''}</td>
                    <td>${event.branch || ''}</td>
                    <td>${event.organizer || ''}</td>
                    <td><button class="delete-btn" onclick="deleteData('events', ${event.id}); renderEvents();">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderTithes() {
            const tbody = document.querySelector('#titheTable tbody');
            tbody.innerHTML = '';
            tithes.forEach(tithe => {
                const row = document.createElement('tr');
                row.dataset.id = tithe.id;
                row.innerHTML = `
                    <td>${tithe.memberName || ''}</td>
                    <td>${tithe.type || ''}</td>
                    <td>${tithe.amount || ''}</td>
                    <td>${tithe.date || ''}</td>
                    <td>${tithe.branch || ''}</td>
                    <td><button class="delete-btn" onclick="deleteData('tithes', ${tithe.id}); renderTithes();">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
            const totalTithe = calculateTotal(tithes, t => t.type === 'Tithe');
            const totalOffering = calculateTotal(tithes, t => t.type === 'Offering');
            document.getElementById('totalTitheDisplay').textContent = totalTithe;
            document.getElementById('totalOfferingDisplay').textContent = totalOffering;
        }

        function renderMinistryLeaders() {
            const tbody = document.querySelector('#ministryLeaderTable tbody');
            tbody.innerHTML = '';
            ministryLeaders.forEach(leader => {
                const row = document.createElement('tr');
                row.dataset.id = leader.id;
                row.innerHTML = `
                    <td>${leader.name || ''}</td>
                    <td>${leader.branch || ''}</td>
                    <td>${leader.email || ''}</td>
                    <td>${leader.cell || ''}</td>
                    <td>${leader.ministry || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderCellLeaders() {
            const tbody = document.querySelector('#cellLeaderTable tbody');
            tbody.innerHTML = '';
            cellLeaders.forEach(leader => {
                const row = document.createElement('tr');
                row.dataset.id = leader.id;
                row.innerHTML = `
                    <td>${leader.name || ''}</td>
                    <td>${leader.branch || ''}</td>
                    <td>${leader.email || ''}</td>
                    <td>${leader.cell || ''}</td>
                    <td>${leader.cellGroup || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderElders() {
            const tbody = document.querySelector('#elderTable tbody');
            tbody.innerHTML = '';
            elders.forEach(elder => {
                const row = document.createElement('tr');
                row.dataset.id = elder.id;
                row.innerHTML = `
                    <td>${elder.name || ''}</td>
                    <td>${elder.branch || ''}</td>
                    <td>${elder.email || ''}</td>
                    <td>${elder.cell || ''}</td>
                    <td>${elder.ordinationDate || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderPastors() {
            const tbody = document.querySelector('#pastorTable tbody');
            tbody.innerHTML = '';
            pastors.forEach(pastor => {
                const row = document.createElement('tr');
                row.dataset.id = pastor.id;
                row.innerHTML = `
                    <td>${pastor.name || ''}</td>
                    <td>${pastor.branch || ''}</td>
                    <td>${pastor.email || ''}</td>
                    <td>${pastor.cell || ''}</td>
                    <td>${pastor.appointmentDate || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderBranchCoordinators() {
            const tbody = document.querySelector('#branchCoordTable tbody');
            tbody.innerHTML = '';
            branchCoordinators.forEach(coord => {
                const row = document.createElement('tr');
                row.dataset.id = coord.id;
                row.innerHTML = `
                    <td>${coord.name || ''}</td>
                    <td>${coord.branch || ''}</td>
                    <td>${coord.email || ''}</td>
                    <td>${coord.cell || ''}</td>
                    <td>${coord.notes || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderAttendance() {
            const tbody = document.querySelector('#attendanceTable tbody');
            tbody.innerHTML = '';
            attendance.forEach(att => {
                const total = parseInt(att.youth || 0) + parseInt(att.adult || 0) + parseInt(att.sundaySchool || 0);
                const row = document.createElement('tr');
                row.dataset.id = att.id;
                row.innerHTML = `
                    <td>${att.branch || ''}</td>
                    <td>${att.date || ''}</td>
                    <td>${att.youth || 0}</td>
                    <td>${att.adult || 0}</td>
                    <td>${att.sundaySchool || 0}</td>
                    <td>${total}</td>
                    <td><button class="delete-btn" onclick="deleteData('attendance', ${att.id}); renderAttendance();">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderWhatsAppHistory() {
            const list = document.getElementById('whatsappList');
            list.innerHTML = '';
            whatsappHistory.forEach(item => {
                const li = document.createElement('li');
                li.className = 'whatsapp-item';
                li.innerHTML = `
                    <div class="whatsapp-item-details">
                        <strong>To:</strong> ${item.recipients.join(', ')}<br>
                        <strong>Message:</strong> ${item.message}<br>
                        <strong>Sent:</strong> ${item.date}
                    </div>
                `;
                list.appendChild(li);
            });
        }

        function renderFollowUps() {
            const list = document.getElementById('followUpList');
            list.innerHTML = '';
            followUps.forEach(fu => {
                const li = document.createElement('li');
                li.className = 'follow-up-item';
                li.innerHTML = `
                    <strong>Visitor:</strong> ${fu.visitorName}<br>
                    <strong>Status:</strong> ${fu.status}<br>
                    <strong>Date:</strong> ${fu.date || 'N/A'}<br>
                    <strong>Notes:</strong> ${fu.notes || 'N/A'}
                `;
                list.appendChild(li);
            });
        }

        function renderReminders() {
            const list = document.getElementById('reminderList');
            list.innerHTML = '';
            const today = new Date().toISOString().split('T')[0];
            reminders.sort((a, b) => new Date(a.reminderDate) - new Date(b.reminderDate));
            reminders.forEach(rem => {
                const li = document.createElement('li');
                li.className = 'reminder-item';
                if (rem.reminderDate === today) li.classList.add('due');
                if (rem.reminderDate < today) li.classList.add('overdue');
                li.innerHTML = `
                    <strong>Visitor:</strong> ${rem.visitorName}<br>
                    <strong>Reminder Date:</strong> ${rem.reminderDate}<br>
                    <strong>Notes:</strong> ${rem.notes || 'Follow up'}
                `;
                list.appendChild(li);
            });
        }

        function renderConferenceReports() {
            const list = document.getElementById('conferenceReportList');
            list.innerHTML = '';
            conferenceReports.forEach(report => {
                const li = document.createElement('li');
                li.className = 'report-item';
                li.innerHTML = `
                    <strong>${report.title}</strong> (${report.date})<br>
                    ${report.content}<br>
                    <button class="report-delete-btn" onclick="deleteData('conferenceReports', ${report.id}); renderConferenceReports();">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        function renderConferenceReportFiles() {
            const list = document.getElementById('conferenceReportFileList');
            list.innerHTML = '';
            conferenceReportFiles.forEach(file => {
                const li = document.createElement('li');
                li.className = 'report-item';
                li.innerHTML = `
                    <strong>${file.title}</strong> (${file.date}) - ${file.fileName}<br>
                    <a class="file-download-link" href="${file.fileData}" download="${file.fileName}">Download</a>
                    <button class="view-btn" onclick="viewConferenceFile(${file.id})">View</button>
                    <button class="report-delete-btn" onclick="deleteData('conferenceReportFiles', ${file.id}); renderConferenceReportFiles();">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        function renderTitheReports() {
            const list = document.getElementById('titheReportList');
            list.innerHTML = '';
            titheReports.forEach(report => {
                const li = document.createElement('li');
                li.className = 'report-item';
                li.innerHTML = `
                    <strong>${report.title}</strong> (${report.date})<br>
                    ${report.content}<br>
                    <button class="report-delete-btn" onclick="deleteData('titheReports', ${report.id}); renderTitheReports();">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        function renderVisitorsReports() {
            const list = document.getElementById('visitorsReportList');
            list.innerHTML = '';
            visitorsReports.forEach(report => {
                const li = document.createElement('li');
                li.className = 'report-item';
                li.innerHTML = `
                    <strong>${report.title}</strong> (${report.date})<br>
                    ${report.content}<br>
                    <button class="report-delete-btn" onclick="deleteData('visitorsReports', ${report.id}); renderVisitorsReports();">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        function renderVault() {
            const list = document.getElementById('vaultList');
            list.innerHTML = '';
            vault.forEach(note => {
                const li = document.createElement('li');
                li.className = 'report-item';
                li.innerHTML = `
                    <strong>${note.title}</strong><br>
                    ${note.content}<br>
                    <button class="report-delete-btn" onclick="deleteData('vault', ${note.id}); renderVault();">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        // Population Functions
        function populateTitheMemberSelect() {
            const select = document.getElementById('titheMemberSelect');
            select.innerHTML = '<option value="">Select Member</option>';
            members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.name;
                option.textContent = member.name;
                select.appendChild(option);
            });
        }

        function populateFollowUpVisitorSelect() {
            const select = document.getElementById('followUpVisitorSelect');
            select.innerHTML = '<option value="">Select Visitor</option>';
            visitors.forEach(visitor => {
                const option = document.createElement('option');
                option.value = visitor.id;
                option.textContent = visitor.name;
                select.appendChild(option);
            });
        }

        function populateVisitorWhatsAppSelect() {
            const select = document.getElementById('visitorWhatsAppSelect');
            select.innerHTML = '<option value="">Select Visitor</option>';
            visitors.forEach(visitor => {
                const option = document.createElement('option');
                option.value = visitor.cell;
                option.textContent = visitor.name;
                select.appendChild(option);
            });
        }

        function populateBroadcastSelect() {
            const select = document.getElementById('broadcastSelect');
            select.innerHTML = '';
            const allContacts = [...members.map(m => ({name: m.name, cell: m.cell})), ...visitors.map(v => ({name: v.name, cell: v.cell}))];
            allContacts.forEach(contact => {
                const option = document.createElement('option');
                option.value = contact.cell;
                option.textContent = contact.name;
                select.appendChild(option);
            });
        }

        // Action Functions
        function convertVisitorToMember(id) {
            const visitor = visitors.find(v => v.id === id);
            if (visitor) {
                addData('members', {
                    name: visitor.name,
                    branch: visitor.branch,
                    email: visitor.email,
                    cell: visitor.cell,
                    address: visitor.address,
                    joinDate: new Date().toISOString().split('T')[0],
                    role: 'Member'
                });
                updateData('visitors', id, { status: 'Converted' });
                renderVisitors();
                renderMembers();
                showNotification('Visitor converted to member!');
            }
        }

        function bulkSendDueReminders() {
            const today = new Date().toISOString().split('T')[0];
            const due = reminders.filter(rem => rem.reminderDate <= today && !rem.sent);
            if (due.length === 0) return showNotification('No due reminders!');
            due.forEach(rem => {
                // Mock send
                showNotification(`Sent reminder to ${rem.visitorName}`);
                updateData('reminders', rem.id, { sent: true });
            });
            renderReminders();
        }

        function sendBroadcast() {
            const selected = Array.from(document.getElementById('broadcastSelect').selectedOptions).map(opt => opt.value);
            const message = document.getElementById('broadcastMessage').value;
            if (selected.length === 0 || !message) return showNotification('Select recipients and message!', 'error');
            addData('whatsappHistory', { recipients: selected, message, date: new Date().toLocaleString() });
            renderWhatsAppHistory();
            showNotification('Broadcast sent!');
        }

        function scheduleBroadcast() {
            showNotification('Broadcast scheduled (mock)');
        }

        function fillVisitorTemplate(template) {
            const select = document.getElementById('visitorWhatsAppSelect');
            const name = select.options[select.selectedIndex]?.text || '[Name]';
            const date = new Date().toLocaleDateString();
            const message = template.replace('[Name]', name).replace('[Date]', date);
            document.getElementById('visitorWhatsAppMessage').value = message;
        }

        // Budget Functions
        function calculateTotals() {
            let grandTotal = 0;
            ['september', 'easter', 'combined'].forEach(event => {
                let eventTotal = 0;
                document.querySelectorAll(`.budget-input[data-event="${event}"]`).forEach(input => {
                    eventTotal += parseFloat(input.value || 0);
                });
                document.getElementById(`${event}-total`).textContent = `Total: $${eventTotal.toFixed(2)}`;
                grandTotal += eventTotal;
            });
            document.getElementById('grand-total').textContent = `Grand Total: $${grandTotal.toFixed(2)}`;
        }

        function saveBudgets() {
            const budgets = { september: {}, easter: {}, combined: {} };
            document.querySelectorAll('.budget-input').forEach(input => {
                budgets[input.dataset.event][input.dataset.category] = parseFloat(input.value || 0);
            });
            saveData('conferenceBudgets', budgets);
            showNotification('Budgets saved!');
        }

        // Analytics Update
        function updateAnalytics() {
            // Stats
            document.getElementById('totalVisitors').textContent = visitors.length;
            const converted = visitors.filter(v => v.status === 'Converted').length;
            document.getElementById('totalConverted').textContent = converted;
            document.getElementById('conversionRate').textContent = visitors.length ? ((converted / visitors.length) * 100).toFixed(2) + '%' : '0%';
            document.getElementById('pendingFollowUps').textContent = followUps.filter(f => f.status !== 'Joined' && f.status !== 'Not Interested').length;
            document.getElementById('totalTithe').textContent = calculateTotal(tithes, t => t.type === 'Tithe');
            document.getElementById('totalOffering').textContent = calculateTotal(tithes, t => t.type === 'Offering');
            const avgTithe = tithes.length ? (calculateTotal(tithes) / tithes.length).toFixed(2) : 0;
            document.getElementById('averageTithe').textContent = avgTithe;
            document.getElementById('totalAttendance').textContent = attendance.reduce((sum, att) => sum + parseInt(att.youth || 0) + parseInt(att.adult || 0) + parseInt(att.sundaySchool || 0), 0);

            // Charts (using Chart.js)
            const ctxVisitors = document.getElementById('visitorsChart').getContext('2d');
            new Chart(ctxVisitors, {
                type: 'line',
                data: { labels: visitors.map(v => v.visitDate), datasets: [{ label: 'Visitors', data: visitors.map(() => 1) }] }
            });

            const ctxConversion = document.getElementById('conversionChart').getContext('2d');
            new Chart(ctxConversion, {
                type: 'pie',
                data: { labels: ['Converted', 'Pending'], datasets: [{ data: [converted, visitors.length - converted] }] }
            });

            const ctxTithe = document.getElementById('titheChart').getContext('2d');
            new Chart(ctxTithe, {
                type: 'bar',
                data: { labels: tithes.map(t => t.date), datasets: [{ label: 'Tithe', data: tithes.filter(t => t.type === 'Tithe').map(t => t.amount) }, { label: 'Offering', data: tithes.filter(t => t.type === 'Offering').map(t => t.amount) }] }
            });

            const ctxAttendance = document.getElementById('attendanceChart').getContext('2d');
            new Chart(ctxAttendance, {
                type: 'line',
                data: { labels: attendance.map(a => a.date), datasets: [{ label: 'Total', data: attendance.map(a => parseInt(a.youth) + parseInt(a.adult) + parseInt(a.sundaySchool)) }] }
            });
        }

        // Payment Functions
        function openPaymentModal() {
            document.getElementById('paymentModal').style.display = 'block';
            togglePaymentMethod();
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        function togglePaymentMethod() {
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            document.getElementById('stripe-payment').classList.toggle('active', method === 'stripe');
            document.getElementById('paypal-payment').classList.toggle('active', method === 'paypal');
        }

        // File Viewer Functions
        let currentPdf = null, currentPage = 1, totalPages = 0, currentScale = 1;

        async function viewConferenceFile(id) {
            const file = conferenceReportFiles.find(f => f.id === id);
            if (!file) return;
            const modal = document.getElementById('fileViewerModal');
            const content = document.getElementById('fileViewerContent');
            const toolbar = document.getElementById('viewerToolbar');
            const loading = content.querySelector('.viewer-loading');
            loading.style.display = 'block';
            toolbar.style.display = 'none';
            modal.style.display = 'block';
            currentPage = 1;
            currentScale = 1;
            document.getElementById('zoomLevel').value = 100;

            try {
                // Assuming file.fileData is a base64 data URL
                const base64 = file.fileData.split(',')[1];
                const binary = atob(base64);
                const arrayBuffer = new Uint8Array(binary.length);
                for (let i = 0; i < binary.length; i++) {
                    arrayBuffer[i] = binary.charCodeAt(i);
                }
                const blob = new Blob([arrayBuffer], { type: file.fileType });
                const url = URL.createObjectURL(blob);

                loading.style.display = 'none';

                if (file.fileType === 'application/pdf') {
                    currentPdf = await pdfjsLib.getDocument(url).promise;
                    totalPages = currentPdf.numPages;
                    document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
                    toolbar.style.display = 'flex';
                    document.getElementById('pdfNav').style.display = 'flex';
                    renderPdfPage(currentPdf, currentPage, currentScale);
                } else if (file.fileType.includes('word') || file.fileType.includes('document')) {
                    const result = await mammoth.convertToHtml({ arrayBuffer });
                    content.innerHTML += `<div class="docx-content">${result.value}</div>`;
                    toolbar.style.display = 'flex';
                    document.getElementById('pdfNav').style.display = 'none';
                } else if (file.fileType.includes('spreadsheet') || file.fileType.includes('excel')) {
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                    const html = XLSX.utils.sheet_to_html(workbook.Sheets[workbook.SheetNames[0]]);
                    content.innerHTML += `<div class="xlsx-content">${html}</div>`;
                    toolbar.style.display = 'flex';
                    document.getElementById('pdfNav').style.display = 'none';
                } else {
                    content.innerHTML += '<iframe src="' + url + '" style="width:100%; height:500px;"></iframe>';
                    toolbar.style.display = 'none';
                }
            } catch (error) {
                loading.textContent = `Error viewing file: ${error.message}`;
            }
        }

        async function renderPdfPage(pdf, pageNum, scale) {
            const page = await pdf.getPage(pageNum);
            const viewport = page.getViewport({ scale });
            const canvas = document.createElement('canvas');
            canvas.className = 'pdf-canvas';
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            const renderContext = { canvasContext: canvas.getContext('2d'), viewport };
            await page.render(renderContext).promise;
            document.getElementById('fileViewerContent').appendChild(canvas);
            document.getElementById('pageInfo').textContent = `${pageNum} / ${totalPages}`;
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderPdfPage(currentPdf, currentPage, currentScale);
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                renderPdfPage(currentPdf, currentPage, currentScale);
            }
        }

        function zoomIn() {
            currentScale += 0.25;
            document.getElementById('zoomLevel').value = currentScale * 100;
            renderPdfPage(currentPdf, currentPage, currentScale);
        }

        function zoomOut() {
            if (currentScale > 0.25) {
                currentScale -= 0.25;
                document.getElementById('zoomLevel').value = currentScale * 100;
                renderPdfPage(currentPdf, currentPage, currentScale);
            }
        }

        function setZoom(value) {
            currentScale = parseInt(value) / 100;
            renderPdfPage(currentPdf, currentPage, currentScale);
        }

        function closeFileViewer() {
            document.getElementById('fileViewerModal').style.display = 'none';
            document.getElementById('fileViewerContent').innerHTML = '<span class="close-viewer" onclick="closeFileViewer()">&times;</span><div id="viewerToolbar" class="viewer-toolbar" style="display:none;"><div class="pdf-page-nav" id="pdfNav" style="display:none;"><button onclick="prevPage()">Prev</button><span id="pageInfo">1 / 1</span><button onclick="nextPage()">Next</button></div><div class="zoom-controls"><button onclick="zoomOut()">-</button><input type="number" id="zoomLevel" min="50" max="200" value="100" onchange="setZoom(this.value)"><button onclick="zoomIn()">+</button></div></div><div class="viewer-loading">Loading...</div>';
        }

        // Export, Print, Email Functions (Mock Implementations)
        function exportData(data, filename) {
            const csv = data.map(row => Object.values(row).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }

        function emailData(data, subject) {
            // Mock email
            showNotification(`Email sent with subject: ${subject}`);
        }

        function printFolder(folderId) {
            const content = document.getElementById(`${folderId}-folder`).innerHTML;
            const printWin = window.open('');
            printWin.document.write(`<html><body>${content}</body></html>`);
            printWin.print();
            printWin.close();
        }

        function toggleFolder(folderId) {
            document.getElementById(`${folderId}-folder`).open = !document.getElementById(`${folderId}-folder`).open;
        }

        function exportMembers() { exportData(members, 'members.csv'); }
        function emailMembers() { emailData(members, 'Members List'); }
        function exportVisitors() { exportData(visitors, 'visitors.csv'); }
        function emailVisitors() { emailData(visitors, 'Visitors List'); }
        function exportEvents() { exportData(events, 'events.csv'); }
        function emailEvents() { emailData(events, 'Events List'); }
        function exportTithes() { exportData(tithes, 'tithes.csv'); }
        function emailTithes() { emailData(tithes, 'Tithes List'); }
        function printTithes() { printFolder('tithe'); }
        function exportMinistryLeaders() { exportData(ministryLeaders, 'ministryLeaders.csv'); }
        function emailMinistryLeaders() { emailData(ministryLeaders, 'Ministry Leaders List'); }
        function exportCellLeaders() { exportData(cellLeaders, 'cellLeaders.csv'); }
        function emailCellLeaders() { emailData(cellLeaders, 'Cell Leaders List'); }
        function exportElders() { exportData(elders, 'elders.csv'); }
        function emailElders() { emailData(elders, 'Elders List'); }
        function exportPastors() { exportData(pastors, 'pastors.csv'); }
        function emailPastors() { emailData(pastors, 'Pastors List'); }
        function exportBranchCoordinators() { exportData(branchCoordinators, 'branchCoordinators.csv'); }
        function emailBranchCoordinators() { emailData(branchCoordinators, 'Branch Coordinators List'); }
        function exportAttendance() { exportData(attendance, 'attendance.csv'); }
        function emailAttendance() { emailData(attendance, 'Attendance List'); }
        function printAttendance() { printFolder('attendance'); }
        function exportWhatsApp() { exportData(whatsappHistory, 'whatsappHistory.csv'); }
        function emailWhatsApp() { emailData(whatsappHistory, 'WhatsApp History'); }
        function exportFollowUps() { exportData(followUps, 'followUps.csv'); }
        function emailFollowUps() { emailData(followUps, 'Follow-Ups List'); }
        function exportReminders() { exportData(reminders, 'reminders.csv'); }
        function emailReminders() { emailData(reminders, 'Reminders List'); }
        function exportConferenceReports() { exportData(conferenceReports, 'conferenceReports.csv'); }
        function emailConferenceReports() { emailData(conferenceReports, 'Conference Reports'); }
        function exportTitheReports() { exportData(titheReports, 'titheReports.csv'); }
        function emailTitheReports() { emailData(titheReports, 'Tithe Reports'); }
        function exportVisitorsReports() { exportData(visitorsReports, 'visitorsReports.csv'); }
        function emailVisitorsReports() { emailData(visitorsReports, 'Visitors Reports'); }
        function exportVault() { exportData(vault, 'vault.csv'); }
        function emailVault() { emailData(vault, 'Vault Notes'); }

        // Form Submission Listeners
        function initFormListeners() {
            // Members
            document.getElementById('memberForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('memberForm');
                const item = {
                    name: document.getElementById('name').value,
                    branch: document.getElementById('branch').value,
                    email: document.getElementById('email').value,
                    cell: document.getElementById('cell').value,
                    address: document.getElementById('address').value,
                    joinDate: document.getElementById('joinDate').value,
                    role: document.getElementById('role').value
                };
                addData('members', item);
                renderMembers();
                form.reset();
                showNotification('Member added!');
            });

            // Visitors
            document.getElementById('visitorForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('visitorForm');
                const item = {
                    name: document.getElementById('visitorName').value,
                    branch: document.getElementById('visitorBranch').value,
                    email: document.getElementById('visitorEmail').value,
                    cell: document.getElementById('visitorCell').value,
                    address: document.getElementById('visitorAddress').value,
                    visitDate: document.getElementById('visitorVisitDate').value,
                    notes: document.getElementById('visitorNotes').value,
                    status: 'Pending'
                };
                addData('visitors', item);
                renderVisitors();
                form.reset();
                showNotification('Visitor added!');
            });

            // Follow-Ups
            document.getElementById('followUpForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('followUpForm');
                const visitorId = parseInt(document.getElementById('followUpVisitorSelect').value);
                const visitor = visitors.find(v => v.id === visitorId);
                const item = {
                    visitorId,
                    visitorName: visitor ? visitor.name : '',
                    status: document.getElementById('followUpStatus').value,
                    date: document.getElementById('followUpDate').value,
                    reminderDate: document.getElementById('followUpReminderDate').value,
                    notes: document.getElementById('followUpNotes').value
                };
                addData('followUps', item);
                if (item.reminderDate) addData('reminders', { ...item, sent: false });
                renderFollowUps();
                renderReminders();
                form.reset();
                showNotification('Follow-up logged!');
            });

            // Events
            document.getElementById('eventForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('eventForm');
                const item = {
                    title: document.getElementById('eventTitle').value,
                    description: document.getElementById('eventDescription').value,
                    date: document.getElementById('eventDate').value,
                    branch: document.getElementById('eventBranch').value,
                    organizer: document.getElementById('eventOrganizer').value
                };
                addData('events', item);
                renderEvents();
                form.reset();
                showNotification('Event added!');
            });

            // Tithes
            document.getElementById('titheForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('titheForm');
                const item = {
                    memberName: document.getElementById('titheMemberSelect').value,
                    type: document.getElementById('titheType').value,
                    amount: document.getElementById('titheAmount').value,
                    date: document.getElementById('titheDate').value,
                    branch: document.getElementById('titheBranch').value
                };
                addData('tithes', item);
                renderTithes();
                form.reset();
                showNotification('Tithe/Offering recorded!');
            });

            // Ministry Leaders
            document.getElementById('ministryLeaderForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('ministryLeaderForm');
                const item = {
                    name: document.getElementById('ministryLeaderName').value,
                    branch: document.getElementById('ministryLeaderBranch').value,
                    email: document.getElementById('ministryLeaderEmail').value,
                    cell: document.getElementById('ministryLeaderCell').value,
                    ministry: document.getElementById('ministryLeaderMinistry').value
                };
                addData('ministryLeaders', item);
                renderMinistryLeaders();
                form.reset();
                showNotification('Ministry Leader added!');
            });

            // Cell Leaders
            document.getElementById('cellLeaderForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('cellLeaderForm');
                const item = {
                    name: document.getElementById('cellLeaderName').value,
                    branch: document.getElementById('cellLeaderBranch').value,
                    email: document.getElementById('cellLeaderEmail').value,
                    cell: document.getElementById('cellLeaderCell').value,
                    cellGroup: document.getElementById('cellLeaderCellGroup').value
                };
                addData('cellLeaders', item);
                renderCellLeaders();
                form.reset();
                showNotification('Cell Leader added!');
            });

            // Elders
            document.getElementById('elderForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('elderForm');
                const item = {
                    name: document.getElementById('elderName').value,
                    branch: document.getElementById('elderBranch').value,
                    email: document.getElementById('elderEmail').value,
                    cell: document.getElementById('elderCell').value,
                    ordinationDate: document.getElementById('elderOrdinationDate').value
                };
                addData('elders', item);
                renderElders();
                form.reset();
                showNotification('Elder added!');
            });

            // Pastors
            document.getElementById('pastorForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('pastorForm');
                const item = {
                    name: document.getElementById('pastorName').value,
                    branch: document.getElementById('pastorBranch').value,
                    email: document.getElementById('pastorEmail').value,
                    cell: document.getElementById('pastorCell').value,
                    appointmentDate: document.getElementById('pastorAppointmentDate').value
                };
                addData('pastors', item);
                renderPastors();
                form.reset();
                showNotification('Pastor added!');
            });

            // Branch Coordinators
            document.getElementById('branchCoordForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('branchCoordForm');
                const item = {
                    name: document.getElementById('branchCoordName').value,
                    branch: document.getElementById('branchCoordBranch').value,
                    email: document.getElementById('branchCoordEmail').value,
                    cell: document.getElementById('branchCoordCell').value,
                    notes: document.getElementById('branchCoordNotes').value
                };
                addData('branchCoordinators', item);
                renderBranchCoordinators();
                form.reset();
                showNotification('Branch Coordinator added!');
            });

            // Attendance
            document.getElementById('attendanceForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('attendanceForm');
                const item = {
                    branch: document.getElementById('attendanceBranch').value,
                    date: document.getElementById('attendanceDate').value,
                    youth: document.getElementById('youthAttendance').value,
                    adult: document.getElementById('adultAttendance').value,
                    sundaySchool: document.getElementById('sundaySchoolAttendance').value
                };
                addData('attendance', item);
                renderAttendance();
                form.reset();
                showNotification('Attendance logged!');
            });

            // Broadcast
            document.getElementById('broadcastForm').addEventListener('submitValidated', sendBroadcast);

            // Visitor WhatsApp
            document.getElementById('visitorWhatsAppForm').addEventListener('submitValidated', () => {
                const select = document.getElementById('visitorWhatsAppSelect');
                const recipient = select.value;
                const message = document.getElementById('visitorWhatsAppMessage').value;
                addData('whatsappHistory', { recipients: [recipient], message, date: new Date().toLocaleString() });
                renderWhatsAppHistory();
                showNotification('Message sent via WhatsApp!');
            });

            // Vault Forms
            document.getElementById('conferenceReportForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('conferenceReportForm');
                const item = {
                    title: document.getElementById('conferenceReportTitle').value,
                    content: document.getElementById('conferenceReportContent').value,
                    date: document.getElementById('conferenceReportDate').value || new Date().toISOString().split('T')[0]
                };
                addData('conferenceReports', item);
                renderConferenceReports();
                form.reset();
                showNotification('Conference report added!');
            });

            document.getElementById('titheReportForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('titheReportForm');
                const item = {
                    title: document.getElementById('titheReportTitle').value,
                    content: document.getElementById('titheReportContent').value,
                    date: document.getElementById('titheReportDate').value || new Date().toISOString().split('T')[0]
                };
                addData('titheReports', item);
                renderTitheReports();
                form.reset();
                showNotification('Tithe report added!');
            });

            document.getElementById('visitorsReportForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('visitorsReportForm');
                const item = {
                    title: document.getElementById('visitorsReportTitle').value,
                    content: document.getElementById('visitorsReportContent').value,
                    date: document.getElementById('visitorsReportDate').value || new Date().toISOString().split('T')[0]
                };
                addData('visitorsReports', item);
                renderVisitorsReports();
                form.reset();
                showNotification('Visitors report added!');
            });

            document.getElementById('vaultForm').addEventListener('submitValidated', () => {
                const form = document.getElementById('vaultForm');
                const item = {
                    title: document.getElementById('vaultTitle').value,
                    content: document.getElementById('vaultContent').value
                };
                addData('vault', item);
                renderVault();
                form.reset();
                showNotification('Secure note added!');
            });

            // Report Generation Buttons
            document.getElementById('generateVisitorReportBtn').addEventListener('click', () => {
                const content = `Total Visitors: ${visitors.length}\nConverted: ${visitors.filter(v => v.status === 'Converted').length}`;
                addData('visitorsReports', { title: 'Generated Visitors Report', content, date: new Date().toISOString().split('T')[0] });
                renderVisitorsReports();
                showNotification('Visitors report generated!');
            });

            document.getElementById('generateTitheReportBtn').addEventListener('click', () => {
                const content = `Total Tithe: $${calculateTotal(tithes, t => t.type === 'Tithe')}\nTotal Offering: $${calculateTotal(tithes, t => t.type === 'Offering')}`;
                addData('titheReports', { title: 'Generated Tithe Report', content, date: new Date().toISOString().split('T')[0] });
                renderTitheReports();
                showNotification('Tithe report generated!');
            });
        }

        // DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            // Bulk uploads
            handleBulkUpload('bulkMemberForm', 'members', ['name', 'email', 'cell', 'address', 'joinDate', 'role', 'branch'], 'membersFilePreview');
            handleBulkUpload('bulkVisitorForm', 'visitors', ['name', 'email', 'cell', 'address', 'visitDate', 'branch', 'notes'], 'visitorsFilePreview');
            handleBulkUpload('bulkAttendanceForm', 'attendance', ['branch', 'date', 'youth', 'adult', 'sundaySchool'], 'attendanceFilePreview');
            handleBulkUpload('bulkEventsForm', 'events', ['title', 'description', 'date', 'branch', 'organizer'], 'eventsFilePreview');
            handleBulkUpload('bulkTitheForm', 'tithes', ['memberName', 'type', 'amount', 'date', 'branch'], 'titheFilePreview');

            // Budget calculations
            document.querySelectorAll('.budget-input').forEach(input => {
                input.addEventListener('input', calculateTotals);
            });

            // Conference Report Upload
            const uploadForm = document.getElementById('conferenceReportUploadForm');
            if (uploadForm) {
                uploadForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!validateForm('conferenceReportUploadForm')) return;
                    const file = document.getElementById('conferenceReportFile').files[0];
                    const title = document.getElementById('fileReportTitle').value;
                    if (!file || !title) return showNotification('Title and file required!', 'error');
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const fileData = e.target.result;
                        addData('conferenceReportFiles', { title, fileName: file.name, fileType: file.type, fileData, date: new Date().toISOString().split('T')[0] });
                        showNotification('Conference report uploaded!');
                        uploadForm.reset();
                        renderConferenceReportFiles();
                    };
                    reader.readAsDataURL(file);
                });
            }

            // Enhanced Searches
            enhancedSearch('memberSearch', '#memberTable', members, ['name', 'email', 'cell', 'address', 'role', 'branch']);
            enhancedSearch('visitorSearch', '#visitorTable', visitors, ['name', 'email', 'cell', 'address', 'branch', 'notes']);
            enhancedSearch('titheSearch', '#titheTable', tithes, ['memberName', 'type', 'date', 'branch']);
            enhancedSearch('eventsSearch', '#eventTable', events, ['title', 'description', 'date', 'branch', 'organizer']);
            enhancedSearch('attendanceSearch', '#attendanceTable', attendance, ['branch', 'date']);

            // Form validations and submissions
            document.querySelectorAll('form[novalidate]').forEach(form => {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (validateForm(form.id)) {
                        form.dispatchEvent(new Event('submitValidated', { bubbles: true }));
                    }
                });
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.addEventListener('blur', () => {
                        const errorDiv = document.getElementById(input.id + '-error');
                        if (errorDiv) errorDiv.classList.remove('show');
                        if (input.checkValidity()) {
                            input.style.borderColor = '#28a745';
                        } else {
                            input.style.borderColor = '#dc3545';
                            if (errorDiv) {
                                errorDiv.textContent = input.validationMessage || 'Invalid input.';
                                errorDiv.classList.add('show');
                            }
                        }
                    });
                });
            });

            initFormListeners();

            // Stripe and PayPal
            const stripe = Stripe('pk_test_your_publishable_key_here');  // Replace with actual key
            const elements = stripe.elements();
            const card = elements.create('card', { style: { base: { fontSize: '16px' } } });
            card.mount('#card-element');
            const displayError = document.getElementById('card-errors');
            card.addEventListener('change', (event) => {
                displayError.textContent = event.error ? event.error.message : '';
            });

            paypal.Buttons({
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: document.getElementById('donationAmount').value || '10.00'
                            }
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        showNotification(`PayPal Payment successful! $${document.getElementById('donationAmount').value} from ${details.payer.name.given_name}.`);
                        closePaymentModal();
                        const today = new Date().toISOString().split('T')[0];
                        addData('tithes', {
                            memberName: details.payer.name.given_name || 'PayPal Donor',
                            type: 'Offering',
                            amount: document.getElementById('donationAmount').value,
                            date: today,
                            branch: 'Online',
                            paymentMethod: 'PayPal'
                        });
                        renderTithes();
                        updateAnalytics();
                    });
                }
            }).render('#paypal-button-container');

            document.getElementById('paymentForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!validateForm('paymentForm')) return;
                if (document.querySelector('input[name="paymentMethod"]:checked').value !== 'stripe') return;
                const amount = document.getElementById('donationAmount').value * 100;
                const recurring = document.querySelector('input[name="recurring"]:checked').value;
                const donorName = document.getElementById('donorName').value;
                const donorEmail = document.getElementById('donorEmail').value;
                const { error, paymentMethod } = await stripe.createPaymentMethod('card', card, {
                    billing_details: { name: donorName, email: donorEmail }
                });
                if (error) {
                    displayError.textContent = error.message;
                } else {
                    showNotification(`Stripe Payment successful! ${recurring} donation of $${document.getElementById('donationAmount').value}.`);
                    closePaymentModal();
                    const today = new Date().toISOString().split('T')[0];
                    addData('tithes', {
                        memberName: donorName || 'Online Donor',
                        type: 'Offering',
                        amount: document.getElementById('donationAmount').value,
                        date: today,
                        branch: 'Online',
                        recurring: recurring,
                        paymentMethod: 'Stripe'
                    });
                    renderTithes();
                    updateAnalytics();
                }
            });

            document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
                radio.addEventListener('change', togglePaymentMethod);
            });

            // Initialize
            showSection('members', document.querySelector('nav button.active'));
        });

        // Sample data init
        function initSampleData() {
            if (events.length === 0) {
                addData('events', {title: 'September Conference', description: 'Annual September Conference', date: '2025-09-15', branch: 'All', organizer: 'Church Admin'});
            }
        }
        setTimeout(initSampleData, 1000);
    </script>
</body>
</html>
