<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity And Faith Mission Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        nav {
            background-color: #34495e;
            padding: 10px;
            text-align: center;
        }
        nav button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        nav button:hover {
            background-color: #2980b9;
        }
        nav button.active {
            background-color: #e74c3c;
        }
        .content {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 20px auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }
        input, select, button, textarea, .file-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        select[multiple] {
            height: 150px;
        }
        input[readonly] {
            background-color: #f9f9f9;
        }
        .file-input {
            border: none;
            background-color: #f9f9f9;
        }
        button[type="submit"] {
            background-color: #27ae60;
            color: white;
            border: none;
            cursor: pointer;
        }
        button[type="submit"]:hover {
            background-color: #229954;
        }
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            display: inline-block;
            margin: 5px 0;
        }
        .whatsapp-btn:hover {
            background-color: #128C7E;
        }
        a.whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        a.whatsapp-link:hover {
            text-decoration: underline;
        }
        .event-list, .tithe-list, .assignment-list, .employee-list, .leave-list, .leader-list, .pastor-list, .cell-list, .elder-list, .report-list, .whatsapp-list {
            list-style: none;
            padding: 0;
        }
        .event-item, .tithe-item, .assignment-item, .employee-item, .leave-item, .leader-item, .pastor-item, .cell-item, .elder-item, .report-item, .whatsapp-item {
            background-color: #f9f9f9;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .total {
            font-weight: bold;
            background-color: #e8f5e8;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 1em;
        }
        .bulk-upload {
            margin-bottom: 20px;
        }
        .bulk-upload input[type="file"] {
            max-width: 300px;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .search-container input {
            width: 100%;
            max-width: 300px;
        }
        .leaders-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .leaders-section {
            flex: 1;
            min-width: 300px;
        }
        .events-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .events-section {
            flex: 1;
            min-width: 300px;
        }
        details {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        summary {
            padding: 10px;
            background-color: #f2f2f2;
            cursor: pointer;
            font-weight: bold;
        }
        .folder-content {
            padding: 10px;
        }
        .folder-actions {
            margin-top: 10px;
            text-align: right;
        }
        .folder-actions button {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .folder-actions .print-btn {
            background-color: #f39c12;
            color: white;
        }
        .folder-actions .export-btn {
            background-color: #3498db;
            color: white;
        }
        .folder-actions .email-btn {
            background-color: #27ae60;
            color: white;
        }
        .folder-actions .minimize-btn {
            background-color: #e74c3c;
            color: white;
        }
        .transport-table input, .essentials-table input, .sunday-school-table input, .grocery-table input, .sound-media-table input, .stage-deco-table input, .guest-pastor-table input {
            width: 100px;
        }
        .budget-date {
            margin-bottom: 10px;
        }
        .budget-total {
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            background-color: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 5px;
            text-align: center;
            font-size: 1em;
            color: #27ae60;
        }
        .grand-total {
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            background-color: #d4edda;
            border: 2px solid #28a745;
            border-radius: 5px;
            text-align: center;
            font-size: 1.1em;
            color: #155724;
        }
        .generate-report-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .generate-report-btn:hover {
            background-color: #2980b9;
        }
        .report-download-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 5px;
        }
        .report-delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .history-icon {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            margin: 10px;
            display: inline-block;
        }
        .history-section {
            display: none;
            margin-top: 20px;
        }
        .history-section.active {
            display: block;
        }
        .history-report-item {
            background-color: #f9f9f9;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        button.delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .add-item-form {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .add-item-form input {
            flex: 1;
            min-width: 150px;
        }
        .add-item-form button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .template-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .template-btn {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .template-btn:hover {
            background-color: #128C7E;
        }
        .whatsapp-history {
            margin-top: 20px;
        }
        .whatsapp-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .whatsapp-item-details {
            flex: 1;
        }
        .broadcast-form {
            max-width: 600px;
        }
        .broadcast-select {
            height: 200px;
        }
        .broadcast-actions {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .broadcast-btn {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .broadcast-btn:hover {
            background-color: #d35400;
        }
    </style>
</head>
<body>
    <header>
        <h1>Charity And Faith Mission Management System</h1>
        <p>Welcome to your church dashboard</p>
    </header>
    
    <nav>
        <button onclick="showSection('members')" class="active">Members</button>
        <button onclick="showSection('events')">Events</button>
        <button onclick="showSection('tithe')">Tithe & Offering</button>
        <button onclick="showSection('leaders')">Ministry Leaders</button>
        <button onclick="showSection('pastors')">Pastors</button>
        <button onclick="showSection('employees')">Employees</button>
        <button onclick="showSection('whatsapp')">WhatsApp Interactions</button>
        <button onclick="showSection('vault')">Vault</button>
    </nav>
    
    <div id="members" class="content active">
        <h2>Member Directory</h2>
        <div class="bulk-upload">
            <h3>Bulk Upload Members (CSV)</h3>
            <p>CSV format: name,email,cell,address,joinDate,role,branch (joinDate optional, defaults to today)</p>
            <form id="bulkMemberForm">
                <input type="file" id="bulkCsv" accept=".csv" required>
                <button type="submit">Upload CSV</button>
            </form>
        </div>
        <div class="search-container">
            <h3>Search Members</h3>
            <input type="text" id="memberSearch" placeholder="Search by name, email, cell, address, or role..." onkeyup="searchMembers()">
        </div>
        <details id="mdf-folder">
            <summary>MDF</summary>
            <div class="folder-content">
                <form id="memberForm">
                    <input type="text" id="name" placeholder="Full Name" required>
                    <select id="branch">
                        <option value="">Select Branch</option>
                        <option value="Khutsong">Khutsong</option>
                        <option value="Mamelodi EXT5">Mamelodi EXT5</option>
                        <option value="Mahube">Mahube</option>
                        <option value="Phase 5">Phase 5</option>
                        <option value="Kwamhlanga">Kwamhlanga</option>
                        <option value="Kameel port">Kameel port</option>
                        <option value="Nelmaphius ext4">Nelmaphius ext4</option>
                        <option value="Nelmaphius ext 6">Nelmaphius ext 6</option>
                    </select>
                    <input type="email" id="email" placeholder="Email" required>
                    <input type="tel" id="cell" placeholder="Cell Number (e.g., +1234567890)" required>
                    <input type="text" id="address" placeholder="Address" required>
                    <input type="date" id="joinDate" required>
                    <select id="role">
                        <option value="Member">Member</option>
                        <option value="Volunteer">Volunteer</option>
                        <option value="Leader">Leader</option>
                    </select>
                    <button type="submit">Add Member</button>
                </form>
                <table id="memberTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Branch</th>
                            <th>Email</th>
                            <th>Cell Number</th>
                            <th>Address</th>
                            <th>Join Date</th>
                            <th>Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Members will be added here -->
                    </tbody>
                </table>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('mdf')">Print</button>
                    <button class="export-btn" onclick="exportMembers()">Export</button>
                    <button class="email-btn" onclick="emailMembers()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('mdf')">Minimize</button>
                </div>
            </div>
        </details>
    </div>
    
    <div id="events" class="content">
        <h2>Events</h2>
        <details id="events-folder">
            <summary>Events Folder</summary>
            <div class="folder-content">
                <h3>Event Calendar</h3>
                <form id="eventForm">
                    <input type="text" id="eventTitle" placeholder="Event Title" required>
                    <input type="date" id="eventDate" required>
                    <input type="time" id="eventTime" required>
                    <textarea id="eventDesc" placeholder="Description"></textarea>
                    <button type="submit">Add Event</button>
                </form>
                <ul id="eventList" class="event-list">
                    <!-- Events will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('events')">Print</button>
                    <button class="export-btn" onclick="exportEvents()">Download</button>
                    <button class="email-btn" onclick="emailEvents()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('events')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="easter-conference-folder">
            <summary>Easter Conference Folder</summary>
            <div class="folder-content">
                <h3>Easter Conference Contribution Directory</h3>
                <div class="bulk-upload">
                    <h4>Bulk Upload Contributions (CSV)</h4>
                    <p>CSV format: member,currency,amount,date,notes</p>
                    <form id="bulkEasterContribForm">
                        <input type="file" id="bulkEasterContribCsv" accept=".csv" required>
                        <button type="submit">Upload CSV</button>
                    </form>
                </div>
                <form id="easterForm">
                    <input type="text" id="easterMember" placeholder="Member Name" required>
                    <select id="easterCurrency">
                        <option value="ZAR">ZAR</option>
                        <option value="USD">USD</option>
                    </select>
                    <input type="number" id="easterAmount" placeholder="Amount" step="0.01" required>
                    <input type="date" id="easterDate" required>
                    <textarea id="easterNotes" placeholder="Notes"></textarea>
                    <button type="submit">Add Contribution</button>
                </form>
                <ul id="easterList" class="tithe-list">
                    <!-- Easter contributions will be added here -->
                </ul>
                <div id="easterTotal" class="total"></div>
                <div class="budget-date">
                    <label for="easterDateBudget">Date:</label>
                    <input type="date" id="easterDateBudget" onchange="saveEasterDate(this.value)">
                </div>
                <details id="easter-transport-folder">
                    <summary>Transport Budget</summary>
                    <div class="folder-content">
                        <h4>Transport budget</h4>
                        <table id="easterTransportTable" class="transport-table">
                            <thead>
                                <tr>
                                    <th>Branch</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Mahube</td>
                                    <td><input type="number" step="0.01" id="easterMahubeAmount" onchange="saveEasterTransportAmount('mahube', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Nelmaphius ext 4</td>
                                    <td><input type="number" step="0.01" id="easterNelmaphiusExt4Amount" onchange="saveEasterTransportAmount('nelmaphiusExt4', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Nelmaphius ext 6</td>
                                    <td><input type="number" step="0.01" id="easterNelmaphiusExt6Amount" onchange="saveEasterTransportAmount('nelmaphiusExt6', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Phase 5</td>
                                    <td><input type="number" step="0.01" id="easterPhase5Amount" onchange="saveEasterTransportAmount('phase5', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Mamelodi Ext5</td>
                                    <td><input type="number" step="0.01" id="easterMamelodiExt5Amount" onchange="saveEasterTransportAmount('mamelodiExt5', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Kwamhlanga/kameel poort</td>
                                    <td><input type="number" step="0.01" id="easterKwamhlangaKameelAmount" onchange="saveEasterTransportAmount('kwamhlangaKameel', this.value); updateEasterAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="easterTransportTotal" class="budget-total">Total Transport Budget: 0.00</div>
                    </div>
                </details>
                <details id="easter-conference-essentials-folder">
                    <summary>Conference Essentials</summary>
                    <div class="folder-content">
                        <h4>Conference Essentials</h4>
                        <table id="easterConferenceEssentialsTable" class="essentials-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Water Bottles</td>
                                    <td><input type="number" step="0.01" id="easterWaterBottlesAmount" onchange="saveEasterConferenceEssentialsAmount('waterBottles', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Juices</td>
                                    <td><input type="number" step="0.01" id="easterJuicesAmount" onchange="saveEasterConferenceEssentialsAmount('juices', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Sweets</td>
                                    <td><input type="number" step="0.01" id="easterSweetsAmount" onchange="saveEasterConferenceEssentialsAmount('sweets', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Toilet Paper</td>
                                    <td><input type="number" step="0.01" id="easterToiletPaperAmount" onchange="saveEasterConferenceEssentialsAmount('toiletPaper', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Drumsticks</td>
                                    <td><input type="number" step="0.01" id="easterDrumsticksAmount" onchange="saveEasterConferenceEssentialsAmount('drumsticks', this.value); updateEasterAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="easterConferenceEssentialsTotal" class="budget-total">Total Conference Essentials: 0.00</div>
                    </div>
                </details>
                <details id="easter-sunday-school-folder">
                    <summary>Sunday School Essentials</summary>
                    <div class="folder-content">
                        <h4>Sunday School Essentials</h4>
                        <table id="easterSundaySchoolTable" class="sunday-school-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Jumping Castle</td>
                                    <td><input type="number" step="0.01" id="easterJumpingCastleAmount" onchange="saveEasterSundaySchoolAmount('jumpingCastle', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Snacks</td>
                                    <td><input type="number" step="0.01" id="easterSnacksAmount" onchange="saveEasterSundaySchoolAmount('snacks', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>First Aid</td>
                                    <td><input type="number" step="0.01" id="easterFirstAidAmount" onchange="saveEasterSundaySchoolAmount('firstAid', this.value); updateEasterAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Security</td>
                                    <td><input type="number" step="0.01" id="easterSecurityAmount" onchange="saveEasterSundaySchoolAmount('security', this.value); updateEasterAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="easterSundaySchoolTotal" class="budget-total">Total Sunday School Essentials: 0.00</div>
                    </div>
                </details>
                <details id="easter-grocery-folder">
                    <summary>Grocery</summary>
                    <div class="folder-content">
                        <h4>Grocery</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Grocery Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkEasterGroceryForm">
                                <input type="file" id="bulkEasterGroceryCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addEasterGroceryForm" class="add-item-form">
                            <input type="text" id="easterGroceryItemName" placeholder="Item Name" required>
                            <input type="number" id="easterGroceryItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="easterGroceryTable" class="grocery-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="easterGroceryTotal" class="budget-total">Total Grocery: 0.00</div>
                    </div>
                </details>
                <details id="easter-sound-media-folder">
                    <summary>Sound and Media</summary>
                    <div class="folder-content">
                        <h4>Sound and Media</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Sound and Media Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkEasterSoundMediaForm">
                                <input type="file" id="bulkEasterSoundMediaCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addEasterSoundMediaForm" class="add-item-form">
                            <input type="text" id="easterSoundMediaItemName" placeholder="Item Name" required>
                            <input type="number" id="easterSoundMediaItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="easterSoundMediaTable" class="sound-media-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="easterSoundMediaTotal" class="budget-total">Total Sound and Media: 0.00</div>
                    </div>
                </details>
                <details id="easter-stage-deco-folder">
                    <summary>Stage and Deco</summary>
                    <div class="folder-content">
                        <h4>Stage and Deco</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Stage and Deco Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkEasterStageDecoForm">
                                <input type="file" id="bulkEasterStageDecoCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addEasterStageDecoForm" class="add-item-form">
                            <input type="text" id="easterStageDecoItemName" placeholder="Item Name" required>
                            <input type="number" id="easterStageDecoItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="easterStageDecoTable" class="stage-deco-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="easterStageDecoTotal" class="budget-total">Total Stage and Deco: 0.00</div>
                    </div>
                </details>
                <details id="easter-guest-pastor-folder">
                    <summary>Guest Pastor</summary>
                    <div class="folder-content">
                        <h4>Guest Pastor</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Guest Pastor Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkEasterGuestPastorForm">
                                <input type="file" id="bulkEasterGuestPastorCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addEasterGuestPastorForm" class="add-item-form">
                            <input type="text" id="easterGuestPastorItemName" placeholder="Item Name" required>
                            <input type="number" id="easterGuestPastorItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="easterGuestPastorTable" class="guest-pastor-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="easterGuestPastorTotal" class="budget-total">Total Guest Pastor: 0.00</div>
                    </div>
                </details>
                <div id="easterGrandTotal" class="grand-total">Grand Total: 0.00</div>
                <button id="easterGenerateReportBtn" class="generate-report-btn">Generate Report ðŸ“Š</button>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('easter-conference')">Print</button>
                    <button class="export-btn" onclick="exportEasterBudget()">Download</button>
                    <button class="email-btn" onclick="emailEasterBudget()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('easter-conference')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="september-conference-folder">
            <summary>September conference folder</summary>
            <div class="folder-content">
                <h3>September Conference Contribution Directory</h3>
                <div class="bulk-upload">
                    <h4>Bulk Upload Contributions (CSV)</h4>
                    <p>CSV format: member,currency,amount,date,notes</p>
                    <form id="bulkSeptemberContribForm">
                        <input type="file" id="bulkSeptemberContribCsv" accept=".csv" required>
                        <button type="submit">Upload CSV</button>
                    </form>
                </div>
                <form id="septemberForm">
                    <input type="text" id="septemberMember" placeholder="Member Name" required>
                    <select id="septemberCurrency">
                        <option value="ZAR">ZAR</option>
                        <option value="USD">USD</option>
                    </select>
                    <input type="number" id="septemberAmount" placeholder="Amount" step="0.01" required>
                    <input type="date" id="septemberDate" required>
                    <textarea id="septemberNotes" placeholder="Notes"></textarea>
                    <button type="submit">Add Contribution</button>
                </form>
                <ul id="septemberList" class="tithe-list">
                    <!-- September contributions will be added here -->
                </ul>
                <div id="septemberTotal" class="total"></div>
                <div class="budget-date">
                    <label for="septemberDateBudget">Date:</label>
                    <input type="date" id="septemberDateBudget" onchange="saveSeptemberDate(this.value)">
                </div>
                <details id="september-transport-folder">
                    <summary>Transport Budget</summary>
                    <div class="folder-content">
                        <h4>Transport budget</h4>
                        <table id="septemberTransportTable" class="transport-table">
                            <thead>
                                <tr>
                                    <th>Branch</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Mahube</td>
                                    <td><input type="number" step="0.01" id="septemberMahubeAmount" onchange="saveSeptemberTransportAmount('mahube', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Nelmaphius ext 4</td>
                                    <td><input type="number" step="0.01" id="septemberNelmaphiusExt4Amount" onchange="saveSeptemberTransportAmount('nelmaphiusExt4', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Nelmaphius ext 6</td>
                                    <td><input type="number" step="0.01" id="septemberNelmaphiusExt6Amount" onchange="saveSeptemberTransportAmount('nelmaphiusExt6', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Phase 5</td>
                                    <td><input type="number" step="0.01" id="septemberPhase5Amount" onchange="saveSeptemberTransportAmount('phase5', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Mamelodi Ext5</td>
                                    <td><input type="number" step="0.01" id="septemberMamelodiExt5Amount" onchange="saveSeptemberTransportAmount('mamelodiExt5', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Kwamhlanga/kameel poort</td>
                                    <td><input type="number" step="0.01" id="septemberKwamhlangaKameelAmount" onchange="saveSeptemberTransportAmount('kwamhlangaKameel', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="septemberTransportTotal" class="budget-total">Total Transport Budget: 0.00</div>
                    </div>
                </details>
                <details id="september-conference-essentials-folder">
                    <summary>Conference Essentials</summary>
                    <div class="folder-content">
                        <h4>Conference Essentials</h4>
                        <table id="septemberConferenceEssentialsTable" class="essentials-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Water Bottles</td>
                                    <td><input type="number" step="0.01" id="septemberWaterBottlesAmount" onchange="saveSeptemberConferenceEssentialsAmount('waterBottles', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Juices</td>
                                    <td><input type="number" step="0.01" id="septemberJuicesAmount" onchange="saveSeptemberConferenceEssentialsAmount('juices', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Sweets</td>
                                    <td><input type="number" step="0.01" id="septemberSweetsAmount" onchange="saveSeptemberConferenceEssentialsAmount('sweets', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Toilet Paper</td>
                                    <td><input type="number" step="0.01" id="septemberToiletPaperAmount" onchange="saveSeptemberConferenceEssentialsAmount('toiletPaper', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Drumsticks</td>
                                    <td><input type="number" step="0.01" id="septemberDrumsticksAmount" onchange="saveSeptemberConferenceEssentialsAmount('drumsticks', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="septemberConferenceEssentialsTotal" class="budget-total">Total Conference Essentials: 0.00</div>
                    </div>
                </details>
                <details id="september-sunday-school-folder">
                    <summary>Sunday School Essentials</summary>
                    <div class="folder-content">
                        <h4>Sunday School Essentials</h4>
                        <table id="septemberSundaySchoolTable" class="sunday-school-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Jumping Castle</td>
                                    <td><input type="number" step="0.01" id="septemberJumpingCastleAmount" onchange="saveSeptemberSundaySchoolAmount('jumpingCastle', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Snacks</td>
                                    <td><input type="number" step="0.01" id="septemberSnacksAmount" onchange="saveSeptemberSundaySchoolAmount('snacks', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>First Aid</td>
                                    <td><input type="number" step="0.01" id="septemberFirstAidAmount" onchange="saveSeptemberSundaySchoolAmount('firstAid', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Security</td>
                                    <td><input type="number" step="0.01" id="septemberSecurityAmount" onchange="saveSeptemberSundaySchoolAmount('security', this.value); updateSeptemberAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="septemberSundaySchoolTotal" class="budget-total">Total Sunday School Essentials: 0.00</div>
                    </div>
                </details>
                <details id="september-grocery-folder">
                    <summary>Grocery</summary>
                    <div class="folder-content">
                        <h4>Grocery</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Grocery Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkGroceryForm">
                                <input type="file" id="bulkGroceryCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addGroceryForm" class="add-item-form">
                            <input type="text" id="groceryItemName" placeholder="Item Name" required>
                            <input type="number" id="groceryItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="septemberGroceryTable" class="grocery-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="septemberGroceryTotal" class="budget-total">Total Grocery: 0.00</div>
                    </div>
                </details>
                <details id="september-sound-media-folder">
                    <summary>Sound and Media</summary>
                    <div class="folder-content">
                        <h4>Sound and Media</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Sound and Media Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkSoundMediaForm">
                                <input type="file" id="bulkSoundMediaCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addSoundMediaForm" class="add-item-form">
                            <input type="text" id="soundMediaItemName" placeholder="Item Name" required>
                            <input type="number" id="soundMediaItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="septemberSoundMediaTable" class="sound-media-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="septemberSoundMediaTotal" class="budget-total">Total Sound and Media: 0.00</div>
                    </div>
                </details>
                <details id="september-stage-deco-folder">
                    <summary>Stage and Deco</summary>
                    <div class="folder-content">
                        <h4>Stage and Deco</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Stage and Deco Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkStageDecoForm">
                                <input type="file" id="bulkStageDecoCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addStageDecoForm" class="add-item-form">
                            <input type="text" id="stageDecoItemName" placeholder="Item Name" required>
                            <input type="number" id="stageDecoItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="septemberStageDecoTable" class="stage-deco-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="septemberStageDecoTotal" class="budget-total">Total Stage and Deco: 0.00</div>
                    </div>
                </details>
                <details id="september-guest-pastor-folder">
                    <summary>Guest Pastor</summary>
                    <div class="folder-content">
                        <h4>Guest Pastor</h4>
                        <div class="bulk-upload">
                            <h5>Bulk Upload Guest Pastor Items (CSV)</h5>
                            <p>CSV format: item,amount</p>
                            <form id="bulkGuestPastorForm">
                                <input type="file" id="bulkGuestPastorCsv" accept=".csv" required>
                                <button type="submit">Upload CSV</button>
                            </form>
                        </div>
                        <form id="addGuestPastorForm" class="add-item-form">
                            <input type="text" id="guestPastorItemName" placeholder="Item Name" required>
                            <input type="number" id="guestPastorItemAmount" placeholder="Amount" step="0.01" required>
                            <button type="submit">Add Item</button>
                        </form>
                        <table id="septemberGuestPastorTable" class="guest-pastor-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamic items will be added here -->
                            </tbody>
                        </table>
                        <div id="septemberGuestPastorTotal" class="budget-total">Total Guest Pastor: 0.00</div>
                    </div>
                </details>
                <div id="septemberGrandTotal" class="grand-total">Grand Total: 0.00</div>
                <button id="septemberGenerateReportBtn" class="generate-report-btn">Generate Report ðŸ“Š</button>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('september-conference')">Print</button>
                    <button class="export-btn" onclick="exportSeptemberBudget()">Download</button>
                    <button class="email-btn" onclick="emailSeptemberBudget()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('september-conference')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="combined-service-folder">
            <summary>Combined Service</summary>
            <div class="folder-content">
                <h3>Combined Service expense</h3>
                <div class="budget-date">
                    <label for="combinedDate">Date:</label>
                    <input type="date" id="combinedDate" onchange="saveCombinedDate(this.value)">
                </div>
                <details id="transport-budget-folder">
                    <summary>Transport Budget</summary>
                    <div class="folder-content">
                        <h4>Transport budget</h4>
                        <table id="transportTable" class="transport-table">
                            <thead>
                                <tr>
                                    <th>Branch</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Mahube</td>
                                    <td><input type="number" step="0.01" id="mahubeAmount" onchange="saveTransportAmount('mahube', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Nelmaphius ext 4</td>
                                    <td><input type="number" step="0.01" id="nelmaphiusExt4Amount" onchange="saveTransportAmount('nelmaphiusExt4', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Nelmaphius ext 6</td>
                                    <td><input type="number" step="0.01" id="nelmaphiusExt6Amount" onchange="saveTransportAmount('nelmaphiusExt6', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Phase 5</td>
                                    <td><input type="number" step="0.01" id="phase5Amount" onchange="saveTransportAmount('phase5', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Mamelodi Ext5</td>
                                    <td><input type="number" step="0.01" id="mamelodiExt5Amount" onchange="saveTransportAmount('mamelodiExt5', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Kwamhlanga/kameel poort</td>
                                    <td><input type="number" step="0.01" id="kwamhlangaKameelAmount" onchange="saveTransportAmount('kwamhlangaKameel', this.value); updateAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="transportTotal" class="budget-total">Total Transport Budget: 0.00</div>
                    </div>
                </details>
                <details id="sunday-essentials-folder">
                    <summary>Sunday Essentials</summary>
                    <div class="folder-content">
                        <h4>Sunday Essentials</h4>
                        <table id="essentialsTable" class="essentials-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Water Bottles</td>
                                    <td><input type="number" step="0.01" id="waterBottlesAmount" onchange="saveEssentialsAmount('waterBottles', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Juices</td>
                                    <td><input type="number" step="0.01" id="juicesAmount" onchange="saveEssentialsAmount('juices', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Sweets</td>
                                    <td><input type="number" step="0.01" id="sweetsAmount" onchange="saveEssentialsAmount('sweets', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Toilet Paper</td>
                                    <td><input type="number" step="0.01" id="toiletPaperAmount" onchange="saveEssentialsAmount('toiletPaper', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Drumsticks</td>
                                    <td><input type="number" step="0.01" id="drumsticksAmount" onchange="saveEssentialsAmount('drumsticks', this.value); updateAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="essentialsTotal" class="budget-total">Total Sunday Essentials: 0.00</div>
                    </div>
                </details>
                <details id="sunday-school-essentials-folder">
                    <summary>Sunday School Essentials</summary>
                    <div class="folder-content">
                        <h4>Sunday School Essentials</h4>
                        <table id="sundaySchoolTable" class="sunday-school-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Amount Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Jumping Castle</td>
                                    <td><input type="number" step="0.01" id="jumpingCastleAmount" onchange="saveSundaySchoolAmount('jumpingCastle', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Snacks</td>
                                    <td><input type="number" step="0.01" id="snacksAmount" onchange="saveSundaySchoolAmount('snacks', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>First Aid</td>
                                    <td><input type="number" step="0.01" id="firstAidAmount" onchange="saveSundaySchoolAmount('firstAid', this.value); updateAllTotals();"></td>
                                </tr>
                                <tr>
                                    <td>Security</td>
                                    <td><input type="number" step="0.01" id="securityAmount" onchange="saveSundaySchoolAmount('security', this.value); updateAllTotals();"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="sundaySchoolTotal" class="budget-total">Total Sunday School Essentials: 0.00</div>
                    </div>
                </details>
                <div id="grandTotal" class="grand-total">Grand Total: 0.00</div>
                <button id="generateReportBtn" class="generate-report-btn">Generate Report ðŸ“Š</button>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('combined-service')">Print</button>
                    <button class="export-btn" onclick="exportCombinedBudget()">Download</button>
                    <button class="email-btn" onclick="emailCombinedBudget()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('combined-service')">Minimize</button>
                </div>
            </div>
        </details>
    </div>
    
    <div id="tithe" class="content">
        <h2>Tithe and Offering Tracking</h2>
        <details id="tithe-folder">
            <summary>Tithe/Offering Folder</summary>
            <div class="folder-content">
                <div class="bulk-upload">
                    <h3>Bulk Upload Tithes/Offerings (CSV)</h3>
                    <p>CSV format: member,currency,amount,date,type</p>
                    <form id="bulkTitheForm">
                        <input type="file" id="bulkTitheCsv" accept=".csv" required>
                        <button type="submit">Upload CSV</button>
                    </form>
                </div>
                <form id="titheForm">
                    <input type="text" id="memberName" placeholder="Member Name" required>
                    <select id="titheCurrency">
                        <option value="ZAR">ZAR</option>
                        <option value="USD">USD</option>
                    </select>
                    <input type="number" id="amount" placeholder="Amount" step="0.01" required>
                    <input type="date" id="titheDate" required>
                    <select id="titheType">
                        <option value="Tithe">Tithe</option>
                        <option value="Offering">Offering</option>
                        <option value="Missions">Missions</option>
                        <option value="Pastors Appreciation">Pastors Appreciation</option>
                    </select>
                    <button type="submit">Record Tithe/Offering</button>
                </form>
                <ul id="titheList" class="tithe-list">
                    <!-- Tithes will be added here -->
                </ul>
                <div id="titheTotal" class="total"></div>
                <button id="generateTitheReportBtn" class="generate-report-btn">Generate Tithe Report ðŸ“Š</button>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('tithe')">Print</button>
                    <button class="export-btn" onclick="exportTithes()">Export</button>
                    <button class="email-btn" onclick="emailTithes()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('tithe')">Minimize</button>
                </div>
            </div>
        </details>
    </div>

    <div id="leaders" class="content">
        <h2>Ministry Leaders</h2>
        <details id="ministry-leaders-folder">
            <summary>Ministry Leaders</summary>
            <div class="folder-content">
                <h3>Ministry Leaders</h3>
                <form id="leaderForm">
                    <input type="text" id="leaderName" placeholder="Name" required>
                    <input type="text" id="leaderMinistry" placeholder="Ministry" required>
                    <input type="email" id="leaderEmail" placeholder="Email" required>
                    <input type="tel" id="leaderCell" placeholder="Cell Number" required>
                    <textarea id="leaderNotes" placeholder="Notes"></textarea>
                    <button type="submit">Add Leader</button>
                </form>
                <ul id="leaderList" class="leader-list">
                    <!-- Leaders will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('ministry-leaders')">Print</button>
                    <button class="export-btn" onclick="exportLeaders()">Export</button>
                    <button class="email-btn" onclick="emailLeaders()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('ministry-leaders')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="cell-leaders-folder">
            <summary>Cell Leaders</summary>
            <div class="folder-content">
                <h3>Cell Leaders</h3>
                <form id="cellLeaderForm">
                    <input type="text" id="cellLeaderName" placeholder="Name" required>
                    <input type="text" id="cellLeaderCell" placeholder="Cell Group" required>
                    <input type="email" id="cellLeaderEmail" placeholder="Email" required>
                    <input type="tel" id="cellLeaderCellNum" placeholder="Cell Number" required>
                    <textarea id="cellLeaderNotes" placeholder="Notes"></textarea>
                    <button type="submit">Add Cell Leader</button>
                </form>
                <ul id="cellLeaderList" class="cell-list">
                    <!-- Cell Leaders will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('cell-leaders')">Print</button>
                    <button class="export-btn" onclick="exportCellLeaders()">Export</button>
                    <button class="email-btn" onclick="emailCellLeaders()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('cell-leaders')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="elders-folder">
            <summary>Elders</summary>
            <div class="folder-content">
                <h3>Elders</h3>
                <form id="elderForm">
                    <input type="text" id="elderName" placeholder="Name" required>
                    <select id="elderRole">
                        <option value="Elder">Elder</option>
                        <option value="Deacon">Deacon</option>
                    </select>
                    <input type="email" id="elderEmail" placeholder="Email" required>
                    <input type="tel" id="elderCell" placeholder="Cell Number" required>
                    <textarea id="elderNotes" placeholder="Notes"></textarea>
                    <button type="submit">Add Elder</button>
                </form>
                <ul id="elderList" class="elder-list">
                    <!-- Elders will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('elders')">Print</button>
                    <button class="export-btn" onclick="exportElders()">Export</button>
                    <button class="email-btn" onclick="emailElders()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('elders')">Minimize</button>
                </div>
            </div>
        </details>
    </div>

    <div id="pastors" class="content">
        <h2>Pastors Directory</h2>
        <details id="pastors-folder">
            <summary>Pastors</summary>
            <div class="folder-content">
                <form id="pastorForm">
                    <input type="text" id="pastorName" placeholder="Name" required>
                    <input type="email" id="pastorEmail" placeholder="Email" required>
                    <input type="tel" id="pastorCell" placeholder="Cell Number" required>
                    <input type="text" id="pastorAddress" placeholder="Address" required>
                    <input type="text" id="pastorSpouse" placeholder="Spouse Name">
                    <button type="submit">Add Pastor</button>
                </form>
                <table id="pastorTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Cell Number</th>
                            <th>Address</th>
                            <th>Spouse</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Pastors will be added here -->
                    </tbody>
                </table>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('pastors')">Print</button>
                    <button class="export-btn" onclick="exportPastors()">Export</button>
                    <button class="email-btn" onclick="emailPastors()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('pastors')">Minimize</button>
                </div>
            </div>
        </details>
    </div>

    <div id="employees" class="content">
        <h2>Employees Management</h2>
        <details id="employees-management-folder">
            <summary>Employees</summary>
            <div class="folder-content">
                <form id="employeeForm">
                    <input type="text" id="empName" placeholder="Name" required>
                    <input type="email" id="empEmail" placeholder="Email" required>
                    <input type="text" id="empPosition" placeholder="Position" required>
                    <input type="date" id="empHireDate" required>
                    <input type="file" id="empCV" class="file-input" accept=".pdf,.doc,.docx">
                    <button type="submit">Add Employee</button>
                </form>
                <table id="employeeTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Position</th>
                            <th>Hire Date</th>
                            <th>CV File</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Employees will be added here -->
                    </tbody>
                </table>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('employees-management')">Print</button>
                    <button class="export-btn" onclick="exportEmployees()">Export</button>
                    <button class="email-btn" onclick="emailEmployees()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('employees-management')">Minimize</button>
                </div>
            </div>
        </details>
        <details id="leave-requests-folder">
            <summary>Leave Requests</summary>
            <div class="folder-content">
                <h3>Leave Requests</h3>
                <form id="leaveForm">
                    <select id="empSelectForLeave" required></select>
                    <input type="date" id="leaveStart" required>
                    <input type="date" id="leaveEnd" required>
                    <select id="leaveType">
                        <option value="Annual">Annual Leave</option>
                        <option value="Sick">Sick Leave</option>
                        <option value="Maternity">Maternity Leave</option>
                    </select>
                    <textarea id="leaveReason" placeholder="Reason"></textarea>
                    <button type="submit">Submit Leave Request</button>
                </form>
                <ul id="leaveList" class="leave-list">
                    <!-- Leaves will be added here -->
                </ul>
                <div class="folder-actions">
                    <button class="print-btn" onclick="printFolder('leave-requests')">Print</button>
                    <button class="export-btn" onclick="exportLeaves()">Export</button>
                    <button class="email-btn" onclick="emailLeaves()">Email</button>
                    <button class="minimize-btn" onclick="toggleFolder('leave-requests')">Minimize</button>
                </div>
            </div>
        </details>
    </div>

    <div id="whatsapp" class="content">
        <h2>WhatsApp Interactions</h2>
        <details id="whatsapp-folder">
            <summary>Send Individual Messages</summary>
            <div class="folder-content">
                <form id="whatsappForm">
                    <label for="whatsappMemberSelect">Select Member:</label>
                    <select id="whatsappMemberSelect" required></select>
                    <label for="whatsappMessage">Message:</label>
                    <textarea id="whatsappMessage" placeholder="Enter your message..." required></textarea>
                    <button type="submit">Send via WhatsApp</button>
                </form>
                <div class="template-buttons">
                    <button type="button" class="template-btn" onclick="fillTemplate('Dear [Name], join us for Sunday service at 9 AM. God bless!')">Service Reminder</button>
                    <button type="button" class="template-btn" onclick="fillTemplate('Hello [Name], you are invited to the Easter Conference on [Date]. RSVP soon!')">Event Invite</button>
                    <button type="button" class="template-btn" onclick="fillTemplate('Thank you [Name] for your tithe. Your support is appreciated!')">Thank You Note</button>
                    <button type="button" class="template-btn" onclick="fillTemplate('Prayer request: [Details]. Let us pray together.')">Prayer Request</button>
                </div>
            </div>
        </details>
        <details id="whatsapp-broadcast-folder">
            <summary>Group Broadcasts</summary>
            <div class="folder-content">
                <form id="broadcastForm" class="broadcast-form">
                    <label for="broadcastMembers">Select Members (Hold Ctrl/Cmd to select multiple):</label>
                    <select id="broadcastMembers" class="broadcast-select" multiple required></select>
                    <label for="broadcastMessage">Broadcast Message:</label>
                    <textarea id="broadcastMessage" placeholder="Enter your broadcast message..." required></textarea>
                    <div class="template-buttons">
                        <button type="button" class="template-btn" onclick="fillBroadcastTemplate('Join us for Sunday service at 9 AM. God bless!')">Service Reminder</button>
                        <button type="button" class="template-btn" onclick="fillBroadcastTemplate('You are all invited to the Easter Conference on [Date]. RSVP soon!')">Event Invite</button>
                        <button type="button" class="template-btn" onclick="fillBroadcastTemplate('Thank you for your continued support and tithes. Blessings!')">Thank You Note</button>
                        <button type="button" class="template-btn" onclick="fillBroadcastTemplate('Let us unite in prayer for [Details].')">Prayer Request</button>
                    </div>
                    <div class="broadcast-actions">
                        <button type="button" class="broadcast-btn" onclick="selectAllMembers()">Select All</button>
                        <button type="submit">Send Broadcast</button>
                    </div>
                    <p><small>Note: This will open WhatsApp links sequentially with a short delay. Ensure you have WhatsApp open.</small></p>
                </form>
            </div>
        </details>
        <details id="whatsapp-history-folder">
            <summary>Interaction History</summary>
            <div class="folder-content">
                <ul id="whatsappList" class="whatsapp-list whatsapp-history">
                    <!-- WhatsApp interactions will be added here -->
                </ul>
            </div>
        </details>
        <div class="folder-actions">
            <button class="print-btn" onclick="printFolder('whatsapp')">Print History</button>
            <button class="export-btn" onclick="exportWhatsAppInteractions()">Export History</button>
            <button class="email-btn" onclick="emailWhatsAppInteractions()">Email History</button>
            <button class="minimize-btn" onclick="toggleFolder('whatsapp-history')">Minimize History</button>
        </div>
    </div>

    <div id="vault" class="content">
        <h2>Vault - Reports Archive</h2>
        <details id="general-reports-folder">
            <summary>General Reports</summary>
            <div class="folder-content">
                <ul id="reportsList" class="report-list">
                    <!-- Reports will be added here -->
                </ul>
            </div>
        </details>
        <details id="tithe-vault-folder">
            <summary>Tithe/Offering Reports</summary>
            <div class="folder-content">
                <ul id="titheReportsList" class="report-list">
                    <!-- Tithe Reports will be added here -->
                </ul>
            </div>
        </details>
        <button class="history-icon" onclick="toggleHistory()">ðŸ“œ History</button>
        <div id="historySection" class="history-section">
            <ul id="historyList">
                <!-- History will be added here -->
            </ul>
        </div>
    </div>

    <script>
        // IndexedDB Setup
        const DB_NAME = 'ChurchManagementDB';
        const DB_VERSION = 1;
        let db;

        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onerror = function(event) {
            console.error('Database error: ' + event.target.errorCode);
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            loadAllData();
        };

        request.onupgradeneeded = function(event) {
            db = event.target.result;

            // Create object stores for each data type
            if (!db.objectStoreNames.contains('members')) {
                db.createObjectStore('members', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('events')) {
                db.createObjectStore('events', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('easterContributions')) {
                db.createObjectStore('easterContributions', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('septemberContributions')) {
                db.createObjectStore('septemberContributions', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('tithes')) {
                db.createObjectStore('tithes', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('leaders')) {
                db.createObjectStore('leaders', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('elders')) {
                db.createObjectStore('elders', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('cellLeaders')) {
                db.createObjectStore('cellLeaders', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('pastors')) {
                db.createObjectStore('pastors', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('employees')) {
                db.createObjectStore('employees', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('leaves')) {
                db.createObjectStore('leaves', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('reports')) {
                db.createObjectStore('reports', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('titheReports')) {
                db.createObjectStore('titheReports', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('historyReports')) {
                db.createObjectStore('historyReports', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('whatsappInteractions')) {
                db.createObjectStore('whatsappInteractions', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('transportBudget')) {
                db.createObjectStore('transportBudget', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('sundayEssentials')) {
                db.createObjectStore('sundayEssentials', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('sundaySchoolEssentials')) {
                db.createObjectStore('sundaySchoolEssentials', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('combinedDate')) {
                db.createObjectStore('combinedDate', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('easterTransportBudget')) {
                db.createObjectStore('easterTransportBudget', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('easterConferenceEssentials')) {
                db.createObjectStore('easterConferenceEssentials', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('easterSundaySchoolEssentials')) {
                db.createObjectStore('easterSundaySchoolEssentials', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('easterGrocery')) {
                db.createObjectStore('easterGrocery', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('easterSoundMedia')) {
                db.createObjectStore('easterSoundMedia', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('easterStageDeco')) {
                db.createObjectStore('easterStageDeco', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('easterGuestPastor')) {
                db.createObjectStore('easterGuestPastor', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('easterDate')) {
                db.createObjectStore('easterDate', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('septemberTransportBudget')) {
                db.createObjectStore('septemberTransportBudget', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('septemberConferenceEssentials')) {
                db.createObjectStore('septemberConferenceEssentials', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('septemberSundaySchoolEssentials')) {
                db.createObjectStore('septemberSundaySchoolEssentials', { keyPath: 'key' });
            }
            if (!db.objectStoreNames.contains('septemberGrocery')) {
                db.createObjectStore('septemberGrocery', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('septemberSoundMedia')) {
                db.createObjectStore('septemberSoundMedia', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('septemberStageDeco')) {
                db.createObjectStore('septemberStageDeco', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('septemberGuestPastor')) {
                db.createObjectStore('septemberGuestPastor', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('septemberDate')) {
                db.createObjectStore('septemberDate', { keyPath: 'key' });
            }
        };

        // Generic functions for IndexedDB operations
        function addData(storeName, data) {
            const transaction = db.transaction([storeName], 'readwrite');
            const store = transaction.objectStore(storeName);
            const request = store.add(data);
            request.onsuccess = function() {
                loadData(storeName);
            };
        }

        function getAllData(storeName) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                request.onsuccess = function(event) {
                    resolve(event.target.result);
                };
                request.onerror = function(event) {
                    reject(event.target.error);
                };
            });
        }

        function updateData(storeName, key, data) {
            const transaction = db.transaction([storeName], 'readwrite');
            const store = transaction.objectStore(storeName);
            const request = store.put({ ...data, key: key });
            request.onsuccess = function() {
                loadData(storeName);
            };
        }

        async function loadData(storeName) {
            try {
                const data = await getAllData(storeName);
                window[`${storeName}`] = data;
                // Call specific render function if exists
                if (typeof window[`render${storeName.charAt(0).toUpperCase() + storeName.slice(1)}`] === 'function') {
                    window[`render${storeName.charAt(0).toUpperCase() + storeName.slice(1)}`]();
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        async function loadAllData() {
            const stores = ['members', 'events', 'easterContributions', 'septemberContributions', 'tithes', 'leaders', 'elders', 'cellLeaders', 'pastors', 'employees', 'leaves', 'reports', 'titheReports', 'historyReports', 'whatsappInteractions', 'easterGrocery', 'easterSoundMedia', 'easterStageDeco', 'easterGuestPastor', 'septemberGrocery', 'septemberSoundMedia', 'septemberStageDeco', 'septemberGuestPastor'];
            for (const store of stores) {
                await loadData(store);
            }
            // Load budget objects
            const budgetStores = ['transportBudget', 'sundayEssentials', 'sundaySchoolEssentials', 'combinedDate', 'easterTransportBudget', 'easterConferenceEssentials', 'easterSundaySchoolEssentials', 'easterDate', 'septemberTransportBudget', 'septemberConferenceEssentials', 'septemberSundaySchoolEssentials', 'septemberDate'];
            for (const store of budgetStores) {
                try {
                    const data = await getAllData(store);
                    window[store.replace(/([A-Z])/g, ' $1').toLowerCase().replace(/\b\w/g, l => l.toUpperCase())] = data.reduce((acc, item) => ({ ...acc, [item.key]: item.value || item }), {});
                } catch (error) {
                    console.error('Error loading budget data:', error);
                }
            }
            // Initial renders
            renderMembers();
            renderEvents();
            renderEasterContributions();
            renderSeptemberContributions();
            renderTithes();
            renderLeaders();
            renderElders();
            renderCellLeaders();
            renderPastors();
            renderEmployees();
            renderLeaves();
            renderTitheReports();
            renderReports();
            renderHistory();
            renderWhatsAppInteractions();
            populateWhatsAppSelect();
            populateBroadcastSelect();
            updateAllTotals();
            updateEasterAllTotals();
            updateSeptemberAllTotals();
        }

        // Data storage (now loaded from DB)
        let members = [];
        let events = [];
        let easterContributions = [];
        let septemberContributions = [];
        let tithes = [];
        let leaders = [];
        let elders = [];
        let cellLeaders = [];
        let pastors = [];
        let employees = [];
        let leaves = [];
        let reports = [];
        let titheReports = [];
        let historyReports = [];
        let whatsappInteractions = [];
        let transportBudget = {};
        let sundayEssentials = {};
        let sundaySchoolEssentials = {};
        let combinedDate = '';
        let easterTransportBudget = {};
        let easterConferenceEssentials = {};
        let easterSundaySchoolEssentials = {};
        let easterGrocery = [];
        let easterSoundMedia = [];
        let easterStageDeco = [];
        let easterGuestPastor = [];
        let easterDate = '';
        let septemberTransportBudget = {};
        let septemberConferenceEssentials = {};
        let septemberSundaySchoolEssentials = {};
        let septemberGrocery = [];
        let septemberSoundMedia = [];
        let septemberStageDeco = [];
        let septemberGuestPastor = [];
        let septemberDate = '';

        // Utility functions
        function showSection(sectionId) {
            document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function formatPhone(phone) {
            // Format for WhatsApp: remove non-digits except leading +, assume international
            return phone.replace(/[\s\-\(\)]/g, '').replace(/^0/, '+');
        }

        function parseCSV(csv) {
            const lines = csv.split('\n').map(line => line.trim()).filter(line => line);
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            return lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                return headers.reduce((obj, header, i) => {
                    obj[header] = values[i] || '';
                    return obj;
                }, {});
            });
        }

        function downloadCSV(data, filename, headers) {
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => row[header] || '').join(','))
            ].join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function emailData(subject, body) {
            const mailto = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(mailto, '_blank');
        }

        // WhatsApp specific functions
        function populateWhatsAppSelect() {
            const select = document.getElementById('whatsappMemberSelect');
            select.innerHTML = '<option value="">Select a member</option>';
            members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.cell;
                option.textContent = `${member.name} - ${member.cell}`;
                select.appendChild(option);
            });
        }

        function populateBroadcastSelect() {
            const select = document.getElementById('broadcastMembers');
            select.innerHTML = '';
            members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.cell;
                option.textContent = `${member.name} - ${member.cell}`;
                select.appendChild(option);
            });
        }

        function selectAllMembers() {
            const select = document.getElementById('broadcastMembers');
            for (let option of select.options) {
                option.selected = true;
            }
        }

        function fillTemplate(template) {
            const messageTextarea = document.getElementById('whatsappMessage');
            const selectedOption = document.getElementById('whatsappMemberSelect').selectedOptions[0];
            let personalized = template.replace(/\[Name\]/g, selectedOption ? selectedOption.textContent.split(' - ')[0] : '[Name]');
            // For date placeholders, you can enhance further if needed
            messageTextarea.value = personalized;
        }

        function fillBroadcastTemplate(template) {
            const messageTextarea = document.getElementById('broadcastMessage');
            messageTextarea.value = template.replace(/\[Name\]/g, 'Dear Member');
        }

        function sendWhatsAppMessage(phone, message) {
            const formattedPhone = formatPhone(phone);
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${formattedPhone.replace('+', '')}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        function sendBroadcast(phones, message) {
            let delay = 0;
            phones.forEach(phone => {
                setTimeout(() => {
                    sendWhatsAppMessage(phone, message);
                }, delay);
                delay += 1000; // 1 second delay between opens
            });
        }

        function renderWhatsAppInteractions() {
            const list = document.getElementById('whatsappList');
            list.innerHTML = '';
            whatsappInteractions.sort((a, b) => new Date(b.date) - new Date(a.date)); // Latest first
            whatsappInteractions.forEach(interaction => {
                const li = document.createElement('li');
                li.classList.add('whatsapp-item');
                if (interaction.type === 'broadcast') {
                    li.innerHTML = `
                        <div class="whatsapp-item-details">
                            <strong>Broadcast to ${interaction.phones.length} members</strong><br>
                            <small>${interaction.date}</small><br>
                            <em>${interaction.message.substring(0, 50)}...</em>
                        </div>
                        <button class="delete-btn" onclick="deleteWhatsAppInteraction(${interaction.id})">Delete</button>
                    `;
                } else {
                    const member = members.find(m => m.cell === interaction.phone) || { name: 'Unknown' };
                    li.innerHTML = `
                        <div class="whatsapp-item-details">
                            <strong>To: ${member.name}</strong><br>
                            <small>${interaction.date}</small><br>
                            <em>${interaction.message.substring(0, 50)}...</em>
                        </div>
                        <button class="delete-btn" onclick="deleteWhatsAppInteraction(${interaction.id})">Delete</button>
                    `;
                }
                list.appendChild(li);
            });
        }

        function deleteWhatsAppInteraction(id) {
            if (confirm('Delete this interaction?')) {
                const transaction = db.transaction(['whatsappInteractions'], 'readwrite');
                const store = transaction.objectStore('whatsappInteractions');
                store.delete(id);
                loadData('whatsappInteractions');
            }
        }

        function exportWhatsAppInteractions() {
            const headers = ['type', 'memberName', 'phone', 'message', 'date'];
            const exportData = whatsappInteractions.map(inter => {
                let memberName = '', phone = '';
                if (inter.type === 'broadcast') {
                    memberName = `${inter.phones.length} members`;
                    phone = inter.phones.join(',');
                } else {
                    const member = members.find(m => m.cell === inter.phone) || { name: 'Unknown' };
                    memberName = member.name;
                    phone = inter.phone;
                }
                return {
                    type: inter.type || 'individual',
                    memberName,
                    phone,
                    message: inter.message,
                    date: inter.date
                };
            });
            downloadCSV(exportData, 'whatsapp_interactions.csv', headers);
        }

        function emailWhatsAppInteractions() {
            const body = whatsappInteractions.map(inter => {
                let details = '';
                if (inter.type === 'broadcast') {
                    details = `Broadcast to ${inter.phones.length} members (${inter.phones.join(', ')})\n`;
                } else {
                    const member = members.find(m => m.cell === inter.phone) || { name: 'Unknown' };
                    details = `To: ${member.name} (${inter.phone})\n`;
                }
                return `${details}Date: ${inter.date}\nMessage: ${inter.message}\n\n`;
            }).join('');
            emailData('WhatsApp Interactions History', body);
        }

        // Event listener for WhatsApp form
        document.getElementById('whatsappForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const phone = document.getElementById('whatsappMemberSelect').value;
            const message = document.getElementById('whatsappMessage').value;
            if (!phone || !message) {
                alert('Please select a member and enter a message.');
                return;
            }
            sendWhatsAppMessage(phone, message);
            const interaction = {
                type: 'individual',
                phone: phone,
                message: message,
                date: new Date().toISOString().split('T')[0]
            };
            addData('whatsappInteractions', interaction);
            e.target.reset();
            document.getElementById('whatsappMemberSelect').selectedIndex = 0;
        });

        // Event listener for Broadcast form
        document.getElementById('broadcastForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const phones = Array.from(document.getElementById('broadcastMembers').selectedOptions).map(option => option.value);
            const message = document.getElementById('broadcastMessage').value;
            if (phones.length === 0 || !message) {
                alert('Please select at least one member and enter a message.');
                return;
            }
            if (confirm(`Send broadcast to ${phones.length} members? This will open multiple WhatsApp tabs.`)) {
                sendBroadcast(phones, message);
                const interaction = {
                    type: 'broadcast',
                    phones: phones,
                    message: message,
                    date: new Date().toISOString().split('T')[0]
                };
                addData('whatsappInteractions', interaction);
                e.target.reset();
                document.getElementById('broadcastMembers').selectedIndex = -1;
            }
        });

        // Budget save and update functions
        function saveTransportAmount(branch, amount) {
            transportBudget[branch] = parseFloat(amount) || 0;
            updateData('transportBudget', branch, transportBudget[branch]);
        }
        function updateAllTotals() {
            const transportTotal = Object.values(transportBudget).reduce((sum, val) => sum + val, 0);
            const essentialsTotal = Object.values(sundayEssentials).reduce((sum, val) => sum + val, 0);
            const sundaySchoolTotal = Object.values(sundaySchoolEssentials).reduce((sum, val) => sum + val, 0);
            const grandTotal = transportTotal + essentialsTotal + sundaySchoolTotal;
            document.getElementById('transportTotal').textContent = `Total Transport Budget: ${transportTotal.toFixed(2)}`;
            document.getElementById('essentialsTotal').textContent = `Total Sunday Essentials: ${essentialsTotal.toFixed(2)}`;
            document.getElementById('sundaySchoolTotal').textContent = `Total Sunday School Essentials: ${sundaySchoolTotal.toFixed(2)}`;
            document.getElementById('grandTotal').textContent = `Grand Total: ${grandTotal.toFixed(2)}`;
        }
        // Similar functions for easter and september (abbreviated)
        function saveEasterDate(date) {
            easterDate = date;
            updateData('easterDate', 'date', date);
        }
        function updateEasterAllTotals() {
            // Implementation similar to updateAllTotals for easter
            const transportTotal = Object.values(easterTransportBudget).reduce((sum, val) => sum + val, 0);
            const essentialsTotal = Object.values(easterConferenceEssentials).reduce((sum, val) => sum + val, 0);
            const sundaySchoolTotal = Object.values(easterSundaySchoolEssentials).reduce((sum, val) => sum + val, 0);
            const groceryTotal = easterGrocery.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const soundMediaTotal = easterSoundMedia.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const stageDecoTotal = easterStageDeco.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const guestPastorTotal = easterGuestPastor.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const grandTotal = transportTotal + essentialsTotal + sundaySchoolTotal + groceryTotal + soundMediaTotal + stageDecoTotal + guestPastorTotal;
            document.getElementById('easterTransportTotal').textContent = `Total Transport Budget: ${transportTotal.toFixed(2)}`;
            document.getElementById('easterConferenceEssentialsTotal').textContent = `Total Conference Essentials: ${essentialsTotal.toFixed(2)}`;
            document.getElementById('easterSundaySchoolTotal').textContent = `Total Sunday School Essentials: ${sundaySchoolTotal.toFixed(2)}`;
            document.getElementById('easterGroceryTotal').textContent = `Total Grocery: ${groceryTotal.toFixed(2)}`;
            document.getElementById('easterSoundMediaTotal').textContent = `Total Sound and Media: ${soundMediaTotal.toFixed(2)}`;
            document.getElementById('easterStageDecoTotal').textContent = `Total Stage and Deco: ${stageDecoTotal.toFixed(2)}`;
            document.getElementById('easterGuestPastorTotal').textContent = `Total Guest Pastor: ${guestPastorTotal.toFixed(2)}`;
            document.getElementById('easterGrandTotal').textContent = `Grand Total: ${grandTotal.toFixed(2)}`;
        }
        function saveSeptemberDate(date) {
            septemberDate = date;
            updateData('septemberDate', 'date', date);
        }
        function updateSeptemberAllTotals() {
            // Similar to easter
            const transportTotal = Object.values(septemberTransportBudget).reduce((sum, val) => sum + val, 0);
            const essentialsTotal = Object.values(septemberConferenceEssentials).reduce((sum, val) => sum + val, 0);
            const sundaySchoolTotal = Object.values(septemberSundaySchoolEssentials).reduce((sum, val) => sum + val, 0);
            const groceryTotal = septemberGrocery.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const soundMediaTotal = septemberSoundMedia.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const stageDecoTotal = septemberStageDeco.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const guestPastorTotal = septemberGuestPastor.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
            const grandTotal = transportTotal + essentialsTotal + sundaySchoolTotal + groceryTotal + soundMediaTotal + stageDecoTotal + guestPastorTotal;
            document.getElementById('septemberTransportTotal').textContent = `Total Transport Budget: ${transportTotal.toFixed(2)}`;
            document.getElementById('septemberConferenceEssentialsTotal').textContent = `Total Conference Essentials: ${essentialsTotal.toFixed(2)}`;
            document.getElementById('septemberSundaySchoolTotal').textContent = `Total Sunday School Essentials: ${sundaySchoolTotal.toFixed(2)}`;
            document.getElementById('septemberGroceryTotal').textContent = `Total Grocery: ${groceryTotal.toFixed(2)}`;
            document.getElementById('septemberSoundMediaTotal').textContent = `Total Sound and Media: ${soundMediaTotal.toFixed(2)}`;
            document.getElementById('septemberStageDecoTotal').textContent = `Total Stage and Deco: ${stageDecoTotal.toFixed(2)}`;
            document.getElementById('septemberGuestPastorTotal').textContent = `Total Guest Pastor: ${guestPastorTotal.toFixed(2)}`;
            document.getElementById('septemberGrandTotal').textContent = `Grand Total: ${grandTotal.toFixed(2)}`;
        }

        // Render budget tables
        function renderTransportBudget() {
            document.getElementById('mahubeAmount').value = transportBudget.mahube || 0;
            // Add similar for other fields...
        }
        // Implement similar render functions for all budgets...

        // Generate reports
        function generateCombinedReport() {
            const report = { name: 'Combined Budget Report', date: new Date().toISOString(), content: 'CSV content' };
            addData('reports', report);
            addToHistory(report);
        }
        // Similar for others

        function generateTitheReport() {
            const total = tithes.reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
            const csvContent = `Tithe and Offering Report\nTotal: ${total.toFixed(2)}\n\nMember,Currency,Amount,Date,Type\n${tithes.map(t => `${t.member},${t.currency},${t.amount},${t.date},${t.type}`).join('\n')}`;
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Tithe_Report_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            const report = {
                name: `Tithe Report ${new Date().toLocaleDateString()}`,
                date: new Date().toISOString(),
                content: csvContent
            };
            addData('titheReports', report);
            addToHistory(report);
        }

        // Export and email functions (update to use DB data)
        function exportTithes() {
            const headers = ['member', 'currency', 'amount', 'date', 'type'];
            downloadCSV(tithes, 'tithes.csv', headers);
        }
        function emailTithes() {
            const body = tithes.map(t => `${t.member}: ${t.currency} ${t.amount} (${t.type}) on ${t.date}`).join('\n');
            emailData('Tithes Export', body);
        }

        // Render functions (update to use global variables loaded from DB)
        function renderTithes() {
            const list = document.getElementById('titheList');
            list.innerHTML = '';
            tithes.forEach(tithe => {
                const li = document.createElement('li');
                li.classList.add('tithe-item');
                li.innerHTML = `<strong>${tithe.member}</strong>: ${tithe.currency} ${tithe.amount} (${tithe.type}) on ${tithe.date}`;
                list.appendChild(li);
            });
            const total = tithes.reduce((sum, tithe) => sum + parseFloat(tithe.amount || 0), 0);
            document.getElementById('titheTotal').innerHTML = `Total: ${total.toFixed(2)}`;
        }

        function renderLeaders() {
            const list = document.getElementById('leaderList');
            list.innerHTML = '';
            leaders.forEach(leader => {
                const li = document.createElement('li');
                li.classList.add('leader-item');
                li.innerHTML = `<strong>${leader.name}</strong> - ${leader.ministry} | ${leader.email} | ${leader.cell}`;
                list.appendChild(li);
            });
        }

        function renderElders() {
            const list = document.getElementById('elderList');
            list.innerHTML = '';
            elders.forEach(elder => {
                const li = document.createElement('li');
                li.classList.add('elder-item');
                li.innerHTML = `<strong>${elder.name}</strong> (${elder.role}) | ${elder.email} | ${elder.cell}`;
                list.appendChild(li);
            });
        }

        function renderCellLeaders() {
            const list = document.getElementById('cellLeaderList');
            list.innerHTML = '';
            cellLeaders.forEach(cellLeader => {
                const li = document.createElement('li');
                li.classList.add('cell-item');
                li.innerHTML = `<strong>${cellLeader.name}</strong> - ${cellLeader.cell} | ${cellLeader.email} | ${cellLeader.cellNum}`;
                list.appendChild(li);
            });
        }

        function renderPastors() {
            const tbody = document.getElementById('pastorTable').querySelector('tbody');
            tbody.innerHTML = '';
            pastors.forEach(pastor => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${pastor.name}</td>
                    <td>${pastor.email}</td>
                    <td>${pastor.cell}</td>
                    <td>${pastor.address}</td>
                    <td>${pastor.spouse || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderEmployees() {
            const tbody = document.getElementById('employeeTable').querySelector('tbody');
            tbody.innerHTML = '';
            employees.forEach(emp => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${emp.name}</td>
                    <td>${emp.email}</td>
                    <td>${emp.position}</td>
                    <td>${emp.hireDate}</td>
                    <td>${emp.cv || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderLeaves() {
            const list = document.getElementById('leaveList');
            list.innerHTML = '';
            leaves.forEach(leave => {
                const li = document.createElement('li');
                li.classList.add('leave-item');
                li.innerHTML = `<strong>${leave.employee}</strong>: ${leave.type} from ${leave.start} to ${leave.end} - ${leave.reason}`;
                list.appendChild(li);
            });
        }

        function renderTitheReports() {
            const list = document.getElementById('titheReportsList');
            list.innerHTML = '';
            titheReports.forEach((report, index) => {
                const li = document.createElement('li');
                li.classList.add('report-item');
                li.innerHTML = `
                    <strong>${report.name}</strong> - ${new Date(report.date).toLocaleDateString()}<br>
                    <button class="report-download-btn" onclick="downloadTitheReport(${index})">Download</button>
                    <button class="report-delete-btn" onclick="deleteTitheReport(${index})">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        function downloadTitheReport(index) {
            const report = titheReports[index];
            const blob = new Blob([report.content], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${report.name}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function deleteTitheReport(index) {
            if (confirm('Delete this report?')) {
                // Implement delete from DB
                const transaction = db.transaction(['titheReports'], 'readwrite');
                const store = transaction.objectStore('titheReports');
                store.delete(titheReports[index].id);
                loadData('titheReports');
            }
        }

        // Bulk upload event listeners (update to use addData)
        document.getElementById('bulkEasterContribForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const file = document.getElementById('bulkEasterContribCsv').files[0];
            if (!file) return alert('Please select a CSV file.');
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const csvData = parseCSV(event.target.result);
                    const newContribs = csvData
                        .filter(row => row.member && !isNaN(parseFloat(row.amount)))
                        .map(row => ({
                            member: row.member.trim(),
                            currency: row.currency || 'ZAR',
                            amount: row.amount,
                            date: row.date || new Date().toISOString().split('T')[0],
                            notes: row.notes || ''
                        }));
                    newContribs.forEach(contrib => addData('easterContributions', contrib));
                    alert(`${newContribs.length} contributions added.`);
                    e.target.reset();
                } catch (error) {
                    alert('Error parsing CSV: ' + error.message);
                }
            };
            reader.readAsText(file);
        });

        // Similar for other bulk uploads...

        document.getElementById('bulkTitheForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const file = document.getElementById('bulkTitheCsv').files[0];
            if (!file) return alert('Please select a CSV file.');
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const csvData = parseCSV(event.target.result);
                    const newTithes = csvData
                        .filter(row => row.member && !isNaN(parseFloat(row.amount)))
                        .map(row => ({
                            member: row.member.trim(),
                            currency: row.currency || 'ZAR',
                            amount: row.amount,
                            date: row.date || new Date().toISOString().split('T')[0],
                            type: row.type || 'Tithe'
                        }));
                    newTithes.forEach(tithe => addData('tithes', tithe));
                    alert(`${newTithes.length} tithes added.`);
                    e.target.reset();
                } catch (error) {
                    alert('Error parsing CSV: ' + error.message);
                }
            };
            reader.readAsText(file);
        });

        // Form submissions (update to use addData)
        // Example for titheForm
        document.getElementById('titheForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const tithe = {
                member: document.getElementById('memberName').value,
                currency: document.getElementById('titheCurrency').value,
                amount: document.getElementById('amount').value,
                date: document.getElementById('titheDate').value,
                type: document.getElementById('titheType').value
            };
            addData('tithes', tithe);
            e.target.reset();
        });

        document.getElementById('generateTitheReportBtn').addEventListener('click', generateTitheReport);

        // Folder toggle function
        function toggleFolder(folderId) {
            const details = document.getElementById(folderId + '-folder');
            if (details) {
                details.open = !details.open;
            }
        }

        // Print, export, email functions for new folders (implement similarly)
        function exportLeaders() {
            const headers = ['name', 'ministry', 'email', 'cell'];
            downloadCSV(leaders, 'leaders.csv', headers);
        }
        function emailLeaders() {
            const body = leaders.map(l => `${l.name} - ${l.ministry} | ${l.email}`).join('\n');
            emailData('Ministry Leaders', body);
        }
        // Similar for cellLeaders, elders, pastors, employees, leaves...

        // Implement printFolder as window.print() or specific logic
        function printFolder(folderId) {
            window.print();
        }

        // History functions (abbreviated)
        function addToHistory(report) {
            addData('historyReports', report);
        }

        function toggleHistory() {
            const section = document.getElementById('historySection');
            section.classList.toggle('active');
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            historyReports.forEach(report => {
                const li = document.createElement('li');
                li.classList.add('history-report-item');
                li.textContent = `${report.name} - ${new Date(report.date).toLocaleDateString()}`;
                list.appendChild(li);
            });
        }

        function renderReports() {
            const list = document.getElementById('reportsList');
            list.innerHTML = '';
            reports.forEach((report, index) => {
                const li = document.createElement('li');
                li.classList.add('report-item');
                li.innerHTML = `
                    <strong>${report.name}</strong> - ${new Date(report.date).toLocaleDateString()}<br>
                    <button class="report-download-btn" onclick="downloadReport(${index})">Download</button>
                    <button class="report-delete-btn" onclick="deleteReport(${index})">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        // Implement downloadReport, deleteReport similarly...
    </script>
</body>
</html>
